<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>[Homework] Lab 03</title>
    <script type="text/javascript" src="three.js"></script>
    <script type="text/javascript" src="stats.js"></script>
    <script type="text/javascript" src="dat.gui.js"></script>
    <script type="text/javascript" src="OrbitControls.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <canvas id="webgl"></canvas>
    <div id="stats"></div>

    <script>
      /*
       * CONSTANTS
       */
      const TEXTURES_DIR = "textures";
      const ISLAND = {
        layers: [
          `
          _______
          _______
          _______
          ___d___
          _______
          _______
          _______
          `,
          `
          _______
          _______
          ___d___
          __d_d__
          ___dd__
          _______
          _______
          `,
          `
          _______
          ___dd__
          __d_dd_
          _d___dd
          __d__d_
          ___dd__
          _______
          `,
          `
          __ss___
          _sd_s__
          _s___s_
          s_____s
          sd____s
          _sd__s_
          __sss__
          `,
          `
          _______
          __gg___
          __ggg__
          _ggggg_
          _ggggg_
          __ggg__
          _______
          `,
          `
          _______
          _______
          _______
          ___b___
          _______
          _______
          _______
          `,
          `
          _______
          _______
          _______
          ___b___
          _______
          _______
          _______
          `,
          `
          _______
          _______
          _______
          ___b___
          _______
          _______
          _______
          `,
          `
          _______
          _______
          ___ll__
          __lll__
          ___l___
          _______
          _______
          `,
          `
          _______
          ___ll__
          __llll_
          _lllll_
          __lll__
          ___l___
          _______
          `,
          `
          _______
          _______
          ___l___
          __lll__
          ___l___
          _______
          _______
          `,
        ],
        objects: {
          d: (size, displayedFaces) => new Dirt(size, displayedFaces),
          g: (size, displayedFaces) => new Grass(size, displayedFaces),
          r: (size, displayedFaces) => new Gravel(size, displayedFaces),
          s: (size, displayedFaces) => new DirtWithGrass(size, displayedFaces),
          l: (size, displayedFaces) => new Leaves(size, displayedFaces),
          b: (size, displayedFaces) => new Bark(size / 2, size, displayedFaces),
        },
      };

      const CHURCH = {
        layers: [
          `
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,w,w,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r
          `,
          `
          _,_,_,w,ws2,_,ws2,w,_,_,_,_,_,_,_,_
          _,_,_,w,w,ws2,w,w,_,w,_,_,_,w,_,_
          cs3,w,w,w,_,_,_,w,w,w,w,w,w,w,w,_
          _,w,_,_,_,_,_,_,_,_,_,w,_,_,w,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          cs3,w,_,_,_,_,_,_,_,_,_,_,_,_,_,ws1
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,w,_,_,_,_,_,_,_,_,_,_,_,_,w
          cs3,w,w,w,_,_,_,c,w,w,w,w,_,_,w,_
          _,_,_,w,w,w,w,w,_,w,_,_,_,_,_,_
          _,_,_,w,ws0,_,ws0,w,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_
          _,_,_,ws3,w,sg0,w,ws1,_,w,_,_,_,w,_,_
          _,w,ws2,w,_,_,_,w,w,w,w,w,w,w,w,_
          _,cs3,w,_,_,_,_,_,_,_,_,w,_,_,w,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,ws1
          _,cs3,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,sg1
          _,cs3,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,ws1
          _,cs3,w,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,ws0,w,_,_,_,w,w,w,w,w,_,_,w,_
          _,_,_,_,w,sg0,w,_,_,w,_,_,_,_,_,_
          _,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_
          _,_,_,_,w,sg0,w,_,_,w,_,_,_,w,_,_
          _,w,_,w,_,_,_,w,w,w,w,w,w,w,w,_
          _,sg1,w,_,_,_,_,_,_,_,_,ws3,ws5,ws7,ws1,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,sg1
          _,sg1,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,sg1
          _,sg1,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,sg1
          _,sg1,w,_,_,_,_,_,_,_,_,_,ws7,ws5,_,w
          _,w,_,w,_,_,_,w,c,w,c,w,cs4,cs4,w,_
          _,_,_,_,w,sg0,w,_,_,w,_,_,_,_,_,_
          _,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,w,sg0,w,_,_,ws2,_,_,_,ws2,_,_
          _,w,_,w,_,_,_,w,w,w,w,w,w,w,w,_
          _,w,w,_,_,_,_,_,_,_,_,_,ws3,ws1,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,sg1
          _,cs7,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,sg1
          _,cs7,_,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,sg1
          _,w,w,_,_,_,_,_,_,_,_,_,ws3,ws1,_,w
          _,w,_,w,_,_,_,w,w,w,w,c,c,c,w,_
          _,_,_,_,w,sg0,w,_,_,ws0,_,_,_,_,_,_
          _,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,ws7,w,sg0,w,ws5,_,_,_,_,_,_,_,_
          _,w,_,w,_,_,_,w,w,w,w,w,w,w,w,_
          _,w,w,_,_,_,_,_,_,_,_,_,_,w,_,w
          _,_,w,_,_,_,_,_,_,_,_,_,_,_,_,ws5
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,sg1
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,w
          _,_,w,_,_,_,_,_,_,_,_,_,_,_,_,ws5
          _,w,w,_,_,_,_,_,_,_,_,_,_,w,_,w
          _,w,_,w,_,_,_,w,w,w,c,w,w,w,w,_
          _,_,_,ws7,w,sg0,w,ws5,_,_,_,_,_,_,_,_
          _,_,_,bs0,bs0,bh0,bs0,bs0,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_
          _,ws3,_,w,w,w,w,w,w,sg0,w,sg0,w,sg0,w,_
          _,_,w,_,_,_,_,_,_,_,_,_,_,w,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,ws2
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,ws5
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,ws0
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,w,_,_,_,_,_,_,_,_,_,_,w,w,_
          _,ws3,_,w,_,_,_,_,w,sg0,w,sg0,w,sg0,w,_
          _,_,_,w,bs0,bs0,bs0,w,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_
          _,ws3,_,w,w,_,w,w,w,sg0,w,sg0,w,sg0,w,_
          _,_,w,_,_,_,_,_,_,_,_,_,_,w,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,ws1
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,w,_,_,_,_,_,_,_,_,_,_,w,w,_
          _,ws3,_,w,_,_,_,_,w,sg0,w,sg0,w,sg0,w,_
          _,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,bs2,bs2,_,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_,_,_
          _,w,ws6,w,w,_,w,w,w,ws6,w,ws6,w,ws6,w,_
          _,_,w,_,_,_,_,_,_,_,_,_,_,w,ws1,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,w
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,w,_,_,_,_,_,_,_,_,_,_,w,ws1,_
          _,w,ws4,w,w,_,w,w,w,w,w,w,w,ws4,w,_
          _,_,_,bs0,bs0,_,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,w,_,_,_,_,_,_,_,_,_,_,_,ws1,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,sg1,_
          _,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,_,w,_,_,_,_,_,_,_,_,_,_,_,ws1,_
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,bs5,_,_,_,_,_,_,_,_,_,_,_,bs7,_
          _,_,bs5,_,_,_,_,_,_,_,_,_,_,_,bs7,_
          _,_,bs5,_,_,_,_,_,_,_,_,_,_,_,bs7,_
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,ws1,_
          _,ws7,_,_,_,_,_,_,_,_,_,_,_,_,w,_
          _,w,_,_,_,_,_,_,_,_,_,_,_,_,ws1,_
          _,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,bs2,w,cs2,w,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_
          _,w,w,w,w,w,w,w,w,w,w,w,w,w,w,_
          _,bs0,w,cs0,w,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,bh1,bh1,bh1,bh1,bh1,bh1,bh1,bh1,bh1,b,_
          _,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
        ],
        objects: {
          r: (size, displayedFaces) => new DirtWithGrass(size, displayedFaces),
          w: (size, displayedFaces) => new WallStone(size, displayedFaces),
          c: (size, displayedFaces) => new CobbleStone(size, displayedFaces),
          b: (size, displayedFaces) => new Wood(size, displayedFaces),
          cs0: (size) => createStairs(CobbleStoneStairs, size, 0),
          cs2: (size) => createStairs(CobbleStoneStairs, size, 2),
          cs3: (size) => createStairs(CobbleStoneStairs, size, 3),
          cs4: (size) => createStairs(CobbleStoneStairs, size, 0, 1),
          cs7: (size) => createStairs(CobbleStoneStairs, size, 3, 1),
          ws0: (size) => createStairs(WallStoneStairs, size, 0),
          ws1: (size) => createStairs(WallStoneStairs, size, 1),
          ws2: (size) => createStairs(WallStoneStairs, size, 2),
          ws3: (size) => createStairs(WallStoneStairs, size, 3),
          ws4: (size) => createStairs(WallStoneStairs, size, 0, 1),
          ws5: (size) => createStairs(WallStoneStairs, size, 1, 1),
          ws6: (size) => createStairs(WallStoneStairs, size, 2, 1),
          ws7: (size) => createStairs(WallStoneStairs, size, 3, 1),
          bs0: (size) => createStairs(WoodenStairs, size, 0),
          bs2: (size) => createStairs(WoodenStairs, size, 2),
          bs5: (size) => createStairs(WoodenStairs, size, 1, 1),
          bs7: (size) => createStairs(WoodenStairs, size, 3, 1),
          bh0: (size, displayedFaces) =>
            new WoodHalf(size, displayedFaces, "top"),
          bh1: (size, displayedFaces) =>
            new WoodHalf(size, displayedFaces, "bottom"),
          sg0: (size) => createGlass(StainedGlass, size, 0),
          sg1: (size) => createGlass(StainedGlass, size, 1),
        },
        empty: new Set([
          "cs0",
          "cs3",
          "cs4",
          "cs7",
          "ws0",
          "ws1",
          "ws2",
          "ws3",
          "ws4",
          "ws5",
          "ws6",
          "ws7",
          "bs0",
          "bs2",
          "bs5",
          "bs7",
          "bh0",
          "bh1",
          "sg0",
          "sg1",
        ]),
      };

      /*
       * UTILS
       */
      const textureLoader = new THREE.TextureLoader();

      const loadTexture = (dirName, textureName, type, extension) =>
        textureLoader.load(
          `${TEXTURES_DIR}/${dirName}/${textureName}_${type}.${extension}`
        );

      const loadTextures = (name, skipped = []) =>
        Object.fromEntries(
          [
            ["ambientOcclusion", "jpg"],
            ["baseColor", "jpg"],
            ["height", "png"],
            ["normal", "jpg"],
            ["roughness", "jpg"],
            ["metallic", "jpg"],
          ]
            .filter(([name, _]) => !skipped.includes(name))
            .map(([type, extension]) => [
              type,
              loadTexture(name, name, type, extension),
            ])
        );

      const createStairs = (Constructor, size, yRotation, reversed = 0) => {
        const stairs = new Constructor(size);
        stairs.rotation.y = (yRotation * Math.PI) / 2;
        if (reversed) {
          stairs.rotation.z += Math.PI;
        }
        return stairs;
      };

      const createGlass = (Constructor, size, yRotation) => {
        const glass = new Constructor(size);
        glass.rotation.y = (yRotation * Math.PI) / 2;
        return glass;
      };

      class Spotlight extends THREE.Group {
        #target = new THREE.Object3D();

        constructor(color, opacity = 1, angle = 0.1) {
          super();
          this.#createSpotlight(color, opacity, angle);
        }

        get target() {
          return this.#target;
        }

        set target(target) {
          if (this.#target?.type === "Object3D") scene.remove(this.#target);
          this.#target = target;
          this.spotlight.target = target;
        }

        lookAt(vector) {
          if (this.#target?.type !== "Object3D") {
            this.target = new THREE.Object3D();
            scene.add(this.target);
          }
          this.#target.position.set(vector.x, vector.y, vector.z);
        }

        showHelper() {
          scene.add(new THREE.SpotLightHelper(this.spotlight));
        }

        showCone(color, opacity, height, segments = 25) {
          const coneGroup = (this.coneGroup = new THREE.Group());
          const radius = 0.9 * height * Math.tan(this.spotlight.angle);
          const cone = (this.cone = new THREE.Mesh(
            new THREE.ConeGeometry(radius, height, segments, 1, true),
            new THREE.MeshLambertMaterial({
              opacity,
              color,
              transparent: true,
            })
          ));
          const { x, y, z } = this.spotlight.position;
          cone.position.set(x, -height / 2, z);
          coneGroup.position.set(x, y, z);
          coneGroup.add(cone);
          this.add(coneGroup);
        }

        #createSpotlight(color, opacity, angle) {
          const spotlight = (this.spotlight = new THREE.SpotLight(
            color,
            opacity
          ));
          spotlight.angle = angle;
          spotlight.penumbra = 0.7;
          spotlight.shadow.camera.near = 0.1;
          spotlight.shadow.camera.far = 100;
          spotlight.shadow.camera.fov = 60;
          spotlight.shadow.mapSize.width = 4096;
          spotlight.shadow.mapSize.height = 4096;
          spotlight.shadow.radius = 40;
          spotlight.shadow.blurSamples = 200;
          spotlight.castShadow = true;
          spotlight.shadow.camera.left = -100;
          spotlight.shadow.camera.right = 100;
          spotlight.shadow.camera.top = 100;
          spotlight.shadow.camera.bottom = -100;

          this.add(spotlight);
        }
      }

      /*
       * SETUP
       */
      // Canvas
      const canvas = document.getElementById("webgl");

      // Scene
      const scene = new THREE.Scene();

      // GUI
      const guiControls = {
        rotate: false,
      };

      const gui = new dat.GUI();
      gui.add(guiControls, "rotate");

      // Statistics
      const stats = new Stats();
      stats.setMode(0);
      stats.domElement.style.position = "absolute";
      stats.domElement.style.left = "0px";
      stats.domElement.style.top = "0px";
      document.getElementById("stats").appendChild(stats.domElement);

      // Helpers
      const axesHelper = new THREE.AxesHelper(25);
      scene.add(axesHelper);

      /*
       * SIZES
       */
      const SIZES = {
        window: {
          width: window.innerWidth,
          height: window.innerHeight,
        },
      };

      /*
       * TEXTURES
       */
      const TEXTURES = {
        dirt: loadTextures("dirt", ["metallic"]),
        grass: loadTextures("grass", ["metallic"]),
        dirtSide: loadTextures("dirt_side", ["metallic"]),
        gravel: loadTextures("gravel", ["metallic"]),
        stainedGlass: loadTextures("stained_glass"),
        leaves: loadTextures("leaves", ["metallic"]),
        bark: loadTextures("bark", ["metallic"]),
        wallStone: loadTextures("wall_stone", ["metallic"]),
        cobblestone: loadTextures("cobblestone", ["metallic"]),
        skybox: {
          top: loadTexture("skybox", "clouds", "top", "jpg"),
          bottom: loadTexture("skybox", "clouds", "bottom", "jpg"),
          left: loadTexture("skybox", "clouds", "left", "jpg"),
          right: loadTexture("skybox", "clouds", "right", "jpg"),
          front: loadTexture("skybox", "clouds", "front", "jpg"),
          back: loadTexture("skybox", "clouds", "back", "jpg"),
        },
      };

      /*
       * MATERIALS
       */
      const MATERIALS = {
        phong: {
          white: new THREE.MeshPhongMaterial({
            color: 0xffffff,
            side: THREE.DoubleSide,
          }),
        },
        cache: {},
      };

      /*
       * GEOMETRIES
       */
      const GEOMETRIES = {
        cache: {},
      };

      class StairsGeometry extends THREE.BufferGeometry {
        constructor(width, height, depth, stepsCount) {
          super();
          const vertices = this.#createVertices(
            width,
            height,
            depth,
            stepsCount
          );
          const joints = this.#joinVertices(stepsCount);
          const positions = joints
            .flatMap((ids) => ids.flatMap((id) => vertices[id]))
            .map((p) => p - 0.5);
          const uvs = this.#createUVs(vertices, joints, width, height, depth);

          this.setAttribute(
            "position",
            new THREE.Float32BufferAttribute(positions, 3)
          );

          this.setAttribute("uv", new THREE.Float32BufferAttribute(uvs, 2));
        }

        #createVertices(width, height, depth, stepsCount) {
          const vertices = [];
          const stepHeight = height / stepsCount;
          const stepDepth = depth / stepsCount;

          for (let i = 0; i <= stepsCount; i++) {
            vertices.push([0, i * stepHeight, 0]);
            vertices.push([width, i * stepHeight, 0]);

            if (i < stepsCount) {
              vertices.push([0, i * stepHeight, depth - i * stepDepth]);
              vertices.push([width, i * stepHeight, depth - i * stepDepth]);
            }

            if (i > 0) {
              vertices.push([0, i * stepHeight, depth - (i - 1) * stepDepth]);
              vertices.push([
                width,
                i * stepHeight,
                depth - (i - 1) * stepDepth,
              ]);
            }
          }

          return vertices;
        }

        #joinVertices(stepsCount) {
          const joints = [];

          joints.push(
            [0, 1, 2],
            [2, 1, 3],
            [0, 4, 1],
            [1, 4, 5],
            [1, 5, 3],
            [3, 5, 9],
            [0, 2, 8],
            [0, 8, 4],
            [2, 3, 8],
            [3, 9, 8]
          );

          let i = 1;
          for (; i < stepsCount - 1; i++) {
            joints.push(
              this.#join3Vertices(i, 0, 6, 1),
              this.#join3Vertices(i, 1, 6, 7),
              this.#join3Vertices(i, 1, 7, 3),
              this.#join3Vertices(i, 3, 7, 11),
              this.#join3Vertices(i, 0, 2, 6),
              this.#join3Vertices(i, 2, 10, 6),
              this.#join3Vertices(i, 2, 3, 10),
              this.#join3Vertices(i, 3, 11, 10),
              this.#join3Vertices(i, 2, 4, 3),
              this.#join3Vertices(i, 3, 4, 5)
            );
          }

          joints.push(
            this.#join3Vertices(i, 0, 6, 1),
            this.#join3Vertices(i, 1, 6, 7),
            this.#join3Vertices(i, 1, 7, 3),
            this.#join3Vertices(i, 3, 7, 9),
            this.#join3Vertices(i, 0, 2, 6),
            this.#join3Vertices(i, 2, 8, 6),
            this.#join3Vertices(i, 2, 3, 8),
            this.#join3Vertices(i, 3, 9, 8),
            this.#join3Vertices(i, 2, 4, 3),
            this.#join3Vertices(i, 3, 4, 5),
            this.#join3Vertices(i, 6, 8, 7),
            this.#join3Vertices(i, 7, 8, 9)
          );

          return joints;
        }

        #join3Vertices(level, a, b, c) {
          return [6 * level + a - 2, 6 * level + b - 2, 6 * level + c - 2];
        }

        #createUVs(vertices, joints, width, height, depth) {
          const uvs = [];

          for (let i = 0; i < joints.length; i++) {
            const [v1, v2, v3] = joints[i].map((id) => vertices[id]);
            if (v1[0] === v2[0] && v2[0] === v3[0]) {
              uvs.push(v1[2] / depth, v1[1] / height);
              uvs.push(v2[2] / depth, v2[1] / height);
              uvs.push(v3[2] / depth, v3[1] / height);
            } else if (v1[1] === v2[1] && v2[1] === v3[1]) {
              uvs.push(v1[0] / width, v1[2] / depth);
              uvs.push(v2[0] / width, v2[2] / depth);
              uvs.push(v3[0] / width, v3[2] / depth);
            } else {
              uvs.push(v1[0] / width, v1[1] / height);
              uvs.push(v2[0] / width, v2[1] / height);
              uvs.push(v3[0] / width, v3[1] / height);
            }
          }

          return uvs;
        }
      }

      /*
       * OBJECTS
       */
      class ObjectWithTexture extends THREE.Mesh {
        constructor(geometry, materials) {
          super(geometry, materials);
        }

        static parseTextures(textures, displayedFaces) {
          let texturesArray = textures;
          if (!(textures instanceof Array))
            texturesArray = new Array(6).fill(0).map((_) => textures);
          return texturesArray.map((texture, idx) =>
            displayedFaces.includes(idx) ? texture : null
          );
        }

        static createMaterial(key, id, type, texture, settings) {
          const cacheKey = `${key}-${id}`;
          if (!MATERIALS.cache[cacheKey]) {
            const maps = {
              map: texture.baseColor,
              aoMap: texture.ambientOcclusion,
              displacementMap: texture.height,
              displacementScale: 0.1,
            };

            if (texture.metallnessMap) {
              maps.metallnessMap = texture.metallnessMap;
              maps.metalness = 0.5;
            }

            if (type === "standard") {
              maps.roughnessMap = texture.roughness;
              maps.roughness = 0.5;
              maps.displacementMap = texture.height;
              maps.displacementScale = 0.1;
              maps.normalMap = texture.normal;
            }

            Object.assign(maps, settings);

            let material;
            switch (type) {
              case "phong":
                material = new THREE.MeshPhongMaterial(maps);
                break;
              case "lambert":
                material = new THREE.MeshLambertMaterial(maps);
                break;
              case "standard":
              default:
                material = new THREE.MeshStandardMaterial(maps);
            }

            MATERIALS.cache[cacheKey] = material;
          }
          return MATERIALS.cache[cacheKey];
        }

        static createMaterials(key, type, textures, settings) {
          return textures.map(
            (texture, idx) =>
              texture &&
              ObjectWithTexture.createMaterial(
                key,
                idx,
                type,
                texture,
                settings.all || settings[idx]
              )
          );
        }
      }

      class Block extends ObjectWithTexture {
        constructor(
          key,
          size,
          textures,
          displayedFaces = [0, 1, 2, 3, 4, 5],
          segments = 64,
          materialType = "standard",
          materialSettings = {}
        ) {
          const width = size.width || size;
          const height = size.height || size;
          const depth = size.depth || size;

          const geometry = Block.#createGeometry(
            key,
            width,
            height,
            depth,
            segments
          );
          const materials = ObjectWithTexture.createMaterials(
            key,
            materialType,
            ObjectWithTexture.parseTextures(textures, displayedFaces),
            materialSettings
          );
          super(geometry, materials);
        }

        static #createGeometry(key, width, height, depth, segments) {
          const cacheKey = `${key}-${width}-${height}-${depth}-${segments}`;

          if (!GEOMETRIES.cache[cacheKey]) {
            const geometry = new THREE.BoxBufferGeometry(
              width,
              height,
              depth,
              segments,
              segments,
              segments
            );
            const uvs = geometry.attributes.uv.array;
            geometry.setAttribute("uv2", new THREE.BufferAttribute(uvs, 2));
            GEOMETRIES.cache[cacheKey] = geometry;
          }

          return GEOMETRIES.cache[cacheKey];
        }
      }

      class Stairs extends ObjectWithTexture {
        constructor(key, size, texture, materialSettings) {
          const geometry = new StairsGeometry(size, size, size, 2);
          const uvs = geometry.attributes.uv.array;
          const material = ObjectWithTexture.createMaterial(
            key,
            0,
            "lambert",
            texture,
            materialSettings
          );
          super(geometry, material);
        }
      }

      class BlockHalf extends Block {
        constructor(
          key,
          size,
          textures,
          displayedFaces = [0, 1, 2, 3, 4, 5],
          side = "top"
        ) {
          if (side === "top" && !displayedFaces.includes(2))
            displayedFaces.push(2);
          else if (!displayedFaces.includes(3)) displayedFaces.push(3);

          console.log({ size });

          super(
            key,
            {
              width: size,
              height: size / 2,
              depth: size,
            },
            textures,
            displayedFaces
          );

          if (side === "top") {
            this.position.y += size / 4;
          } else {
            this.position.y -= size / 4;
          }
        }
      }

      // class Cylinder extends ObjectWithTexture {
      //   constructor(
      //     radius,
      //     height,
      //     texture,
      //     radialSegments = 32,
      //     heightSegments = 1,
      //     openEnded = false,
      //     materialType = "standard",
      //     materialSettings = {}
      //   ) {
      //     const geometry = new THREE.CylinderBufferGeometry(
      //       radius,
      //       radius,
      //       height,
      //       radialSegments,
      //       heightSegments,
      //       openEnded
      //     );
      //     const uvs = geometry.attributes.uv.array;
      //     geometry.setAttribute("uv2", new THREE.BufferAttribute(uvs, 2));
      //     const material = ObjectWithTexture.createMaterial(
      //       materialType,
      //       texture,
      //       materialSettings
      //     );
      //     super(geometry, material);
      //   }
      // }

      class Dirt extends Block {
        constructor(size, displayedFaces) {
          super("dirt", size, TEXTURES.dirt, displayedFaces);
        }
      }

      class Grass extends Block {
        constructor(size, displayedFaces) {
          super("grass", size, TEXTURES.grass, displayedFaces, 64, "standard", {
            displacementScale: 0.2,
          });
        }
      }

      class DirtWithGrass extends Block {
        constructor(size, displayedFaces) {
          super(
            "dirt-with-grass",
            size,
            [
              TEXTURES.dirtSide,
              TEXTURES.dirtSide,
              TEXTURES.grass,
              TEXTURES.dirt,
              TEXTURES.dirtSide,
              TEXTURES.dirtSide,
            ],
            displayedFaces,
            128,
            "standard",
            {
              2: {
                displacementScale: 0.25,
              },
            }
          );
        }
      }

      class Gravel extends Block {
        constructor(size, displayedFaces) {
          super("gravel", size, TEXTURES.gravel, displayedFaces);
        }
      }

      class Leaves extends Block {
        constructor(size, displayedFaces) {
          super(
            "leaves",
            size,
            TEXTURES.leaves,
            displayedFaces,
            128,
            "standard",
            {
              all: { displacementScale: 0.15 },
            }
          );
        }
      }

      class WallStone extends Block {
        constructor(size, displayedFaces) {
          super("wall-stone", size, TEXTURES.wallStone, displayedFaces);
        }
      }

      class CobbleStone extends Block {
        constructor(size, displayedFaces) {
          super("cobblestone", size, TEXTURES.cobblestone, displayedFaces);
        }
      }

      class Wood extends Block {
        constructor(size, displayedFaces) {
          super("wood", size, TEXTURES.bark, displayedFaces);
        }
      }

      class WoodHalf extends BlockHalf {
        constructor(size, displayedFaces, side) {
          super("wood", size, TEXTURES.bark, displayedFaces, side);
        }
      }

      class WallStoneStairs extends Stairs {
        constructor(size) {
          super("wall-stone-stairs", size, TEXTURES.wallStone);
        }
      }

      class CobbleStoneStairs extends Stairs {
        constructor(size) {
          super("cobblestone-stairs", size, TEXTURES.cobblestone);
        }
      }

      class WoodenStairs extends Stairs {
        constructor(size) {
          super("wooden-stairs", size, TEXTURES.bark);
        }
      }

      // class Bark extends Block {
      //   constructor(radius, height, openEnded) {
      //     super(height, TEXTURES.bark);
      //   }
      // }

      class Glass extends Block {
        constructor(key, size, texture, settings) {
          super(
            key,
            {
              width: size,
              height: size,
              depth: size / 10,
            },
            texture,
            [4, 5],
            256,
            "standard",
            {
              all: {
                metalness: 0.2,
                displacementScale: 0.05,
                roughness: 0.5,
                transparent: true,
                alphaMap: loadTexture(
                  "stained_glass",
                  "stained_glass",
                  "transparency",
                  "jpg"
                ),
                ...settings,
              },
            }
          );
        }
      }

      class StainedGlass extends Glass {
        constructor(size) {
          super("stained-glass", size, TEXTURES.stainedGlass);
        }
      }

      class Construction extends THREE.Group {
        constructor(data, blockSize) {
          super();
          this.data = data;
          this.parsedLayers = this.#parseLayers(data.layers);
          this.ySegments = data.layers.length;
          this.zSegments = this.parsedLayers[0].length;
          this.xSegments = this.parsedLayers[0][0].length;
          const layersGroup = this.#createLayers(data, blockSize);
          layersGroup.position.y += blockSize / 2;
          layersGroup.position.x -= ((this.xSegments - 1) * blockSize) / 2;
          layersGroup.position.z -= ((this.zSegments - 1) * blockSize) / 2;
          this.add(layersGroup);
        }

        #parseLayerText(text) {
          return text
            .split("\n")
            .map((row) => row.trim())
            .filter(Boolean)
            .map((row) => {
              let rowArray = row.split(",");
              if (!(rowArray instanceof Array)) rowArray = row.split("");
              return rowArray;
            });
        }

        #parseLayers(layers) {
          return layers.map((layer) =>
            layer instanceof Array ? layer : this.#parseLayerText(layer)
          );
        }

        #createLayers(data, blockSize) {
          const layersGroup = new THREE.Group();
          this.parsedLayers.map((layer, y) => {
            const layerGroup = new THREE.Group();
            layer.forEach((row, z) => {
              row.forEach((symbol, x) => {
                if (symbol === "_") return;
                const displayedFaces = this.#getDisplayedFaces(x, y, z);
                if (!displayedFaces.length) return;
                try {
                  const object = data.objects[symbol](
                    blockSize,
                    displayedFaces
                  );
                  const position = this.#getPosition(x, y, z, blockSize);
                  object.position.set(
                    position.x,
                    object.position.y + position.y,
                    position.z
                  );
                  layerGroup.add(object);
                } catch (e) {
                  console.error(`'${symbol}' is not recognized: ` + e);
                }
              });
              layersGroup.add(layerGroup);
            });
          });
          return layersGroup;
        }

        #getDisplayedFaces(x, y, z) {
          const displayedFaces = [];

          if (this.#isEmpty(x, y, z - 1)) displayedFaces.push(5); // back side
          if (this.#isEmpty(x, y, z + 1)) displayedFaces.push(4); // front side
          if (this.#isEmpty(x, y - 1, z)) displayedFaces.push(3); // bottom side
          if (this.#isEmpty(x, y + 1, z)) displayedFaces.push(2); // top side
          if (this.#isEmpty(x - 1, y, z)) displayedFaces.push(1); // left side
          if (this.#isEmpty(x + 1, y, z)) displayedFaces.push(0); // right side

          return displayedFaces;
        }

        #getPosition(x, y, z, blockSize) {
          return new THREE.Vector3(x * blockSize, y * blockSize, z * blockSize);
        }

        #isEmpty(x, y, z) {
          return (
            x < 0 ||
            x >= this.xSegments ||
            y < 0 ||
            y >= this.ySegments ||
            z < 0 ||
            z >= this.zSegments ||
            this.#isEmptySymbol(this.parsedLayers[y][z][x])
          );
        }

        #isEmptySymbol(symbol) {
          return symbol === "_" || this.data.empty.has(symbol);
        }
      }

      const church = new Construction(CHURCH, 1);
      scene.add(church);

      // const glass = new StainedGlass(1);
      // scene.add(glass);

      const light = new THREE.DirectionalLight(0xfff0dd, 1);
      light.position.set(0, 5, 10);
      scene.add(light);

      /*
       * SKYBOX
       */
      const skybox = new THREE.Mesh(
        new THREE.BoxGeometry(10000, 10000, 10000),
        ["right", "left", "top", "bottom", "front", "back"].map(
          (side) =>
            new THREE.MeshBasicMaterial({
              map: TEXTURES.skybox[side],
              side: THREE.BackSide,
            })
        )
      );
      scene.add(skybox);

      /*
       * LIGHTS
       */
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.65);
      scene.add(ambientLight);

      const spotLight = new Spotlight(0xffffff, 1, 0.5);
      spotLight.position.set(20, 40, 20);
      spotLight.lookAt(new THREE.Vector3(0, 10, 0));
      scene.add(spotLight);

      const spotLight2 = new Spotlight(0xffffff, 1, 0.2);
      spotLight2.position.set(10, 30, 10);
      spotLight2.lookAt(new THREE.Vector3(0, 25, 0));
      scene.add(spotLight2);

      /*
       * CAMERA
       */
      const camera = new THREE.PerspectiveCamera(
        75,
        SIZES.window.width / SIZES.window.height,
        0.1,
        10000
      );
      camera.position.x = 15;
      camera.position.y = 20;
      camera.position.z = 15;
      camera.lookAt(new THREE.Vector3(0, 10, 0));
      scene.add(camera);

      // Controls
      const orbitControls = new THREE.OrbitControls(camera, canvas);
      orbitControls.enableDamping = true;

      /*
       * RENDERER
       */
      const renderer = new THREE.WebGLRenderer({
        canvas,
        antialias: true,
      });
      renderer.setClearColor(new THREE.Color(0xeeeeee));

      /*
       * EVENTS
       */
      // Event handlers
      const handleResize = () => {
        // Update window sizes
        const width = (SIZES.window.width = window.innerWidth);
        const height = (SIZES.window.height = window.innerHeight);

        // Update camera
        camera.aspect = width / height;
        camera.updateProjectionMatrix();

        // Update renderer
        renderer.setSize(width, height);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      };

      // Event listeners
      window.addEventListener("resize", handleResize);

      /*
       * ANIMATIONS
       */
      const update = () => {
        // Update stats
        stats.update();
        // Call animation functions
        if (guiControls.rotate) {
          church.rotation.y += 0.005;
        }
        // Render the next frame
        renderer.render(scene, camera);
        // Request the new animation frame
        requestAnimationFrame(update);
      };

      /*
       * MAIN
       */
      handleResize();
      update();
    </script>
  </body>
</html>
