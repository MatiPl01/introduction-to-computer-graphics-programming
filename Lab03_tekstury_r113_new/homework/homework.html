<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>[Homework] Lab 03</title>
    <script type="text/javascript" src="three.js"></script>
    <script type="text/javascript" src="stats.js"></script>
    <script type="text/javascript" src="dat.gui.js"></script>
    <script type="text/javascript" src="OrbitControls.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <canvas id="webgl"></canvas>
    <div id="stats"></div>

    <script>
      /*
       * CONSTANTS
       */
      const TEXTURES_DIR = "textures";
      const TEXTURES_RESOLUTION = 1024; // 1024 or 128
      const SEGMENTS_FACTOR = 1; // any positive integer

      const CHURCH = {
        layers: [
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,d,d,d,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,d,d,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,d,d,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_
          _,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_
          _,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,d,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,d,d,d,_,d,d,d,d,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_
          _,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_
          _,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_
          _,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_
          _,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_
          _,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_
          _,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_
          _,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_
          _,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_
          _,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_
          _,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,d,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,d,_,d,d,d,d,d,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_
          _,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_
          _,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_
          _,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_
          _,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_
          _,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_
          _,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_
          _,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_
          _,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_
          _,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_
          _,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_
          _,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_
          _,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_
          _,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_
          _,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_
          _,_,_,_,_,_,d,d,d,d,d,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,d,d,d,d,d,d,d,d,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,d,d,d,d,d,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,d,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,r,r,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,r,_,_,r,r,r,r,r,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,r,d,r,r,r,r,g,r,g,r,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,r,r,g,r,g,r,d,g,d,r,g,d,r,r,_,_,_,_,_,_
          _,_,_,_,r,r,g,d,d,g,r,g,r,r,r,r,r,d,d,g,r,_,_,_,_,_
          _,_,_,_,r,g,r,g,r,r,r,r,r,r,r,r,r,r,r,g,g,r,r,_,_,_
          _,_,_,r,r,g,d,r,r,t,t,t,r,r,r,r,r,r,r,d,g,r,r,_,_,_
          _,_,r,g,g,d,r,t,t,t,t,t,t,t,t,t,r,t,t,r,g,d,r,r,_,_
          _,r,g,r,r,r,t,t,t,t,t,t,t,t,t,t,t,t,t,r,r,g,r,r,r,_
          _,r,d,g,r,r,r,t,t,t,t,t,or,t,or,t,or,t,t,t,r,r,r,r,r,r
          r,r,g,r,r,r,r,t,t,t,or,or,or,or,or,or,or,or,or,t,r,r,r,r,r,r
          r,r,r,g,r,r,r,t,t,t,t,t,or,t,or,t,or,t,t,t,r,r,r,r,r,_
          _,r,r,r,g,r,r,t,t,t,t,t,t,t,t,t,t,t,t,t,r,r,r,r,_,_
          _,r,d,g,r,r,r,r,t,t,t,t,t,t,t,t,t,t,t,t,r,r,r,r,r,_
          r,r,r,g,r,r,r,r,r,t,t,t,r,r,r,r,r,w,w,r,r,r,r,r,r,_
          _,r,d,r,g,r,r,r,r,r,r,r,r,r,r,r,r,g,r,r,r,r,r,r,_,_
          _,r,r,g,r,r,r,r,r,r,r,r,r,r,r,r,r,g,g,r,r,r,r,_,_,_
          _,_,r,r,g,r,r,d,r,r,r,r,r,g,r,g,d,g,r,d,r,r,_,_,_,_
          _,_,_,r,r,g,r,r,r,d,r,d,g,g,d,g,r,g,d,r,r,r,_,_,_,_
          _,_,_,_,_,r,g,g,r,r,g,g,r,d,g,r,r,r,r,r,r,_,_,_,_,_
          _,_,_,_,_,_,r,r,r,d,r,r,r,r,r,r,r,r,r,r,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,r,r,r,d,r,g,d,r,r,r,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,r,r,r,g,r,r,r,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,r,r,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,l,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,l,_,_,l,as0,as0,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,l,w,ws2,_,ws2,w,l,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,l,l,w,w,ws2,w,w,l,w,l,bs2,bs2,w,_,_,_,_,_,_,_
          _,_,_,_,_,cs3,w,w,w,ah1,ah1,ah1,w,w,w,w,w,w,w,w,_,_,_,_,_,_
          _,_,_,_,_,_,w,w,ah1,ah1,ah1,ah1,_,_,_,_,w,_,_,w,w,_,_,_,_,_
          _,_,_,_,_,l,w,ah1,b,b,or,_,_,as3,_,as3,_,as3,_,as3,w,_,_,_,_,_
          _,cs1,ch1,_,_,l,w,ah1,b,b,or,_,_,as3,_,as3,_,as3,_,as3,w,_,_,_,db,_
          l,_,_,_,_,cs3,w,ah1,b,b,or,_,_,_,_,_,_,_,_,_,ws1,_,_,_,_,_
          l,_,db,_,_,_,w,ah1,b,b,or,_,_,as3,_,as3,_,_,_,as3,w,_,_,_,l,_
          _,_,_,_,_,l,w,ah1,b,b,or,_,_,as3,_,as3,_,_,_,as3,w,_,_,l,_,_
          _,cs1,ch1,_,_,l,w,w,ah1,a,a,ah1,_,_,_,_,w,_,_,w,w,_,_,_,l,_
          l,_,_,_,_,cs3,w,w,w,ah1,ah1,ah1,c,w,w,w,w,d0,d0,w,_,_,_,_,l,_
          _,cs1,ch1,_,_,_,l,l,w,w,w,w,w,l,w,l,bs1,_,_,bs3,_,_,_,_,_,_
          _,l,_,_,_,_,_,_,w,ws0,_,ws0,w,l,_,l,w,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,l,l,_,l,_,_,_,_,_,_,_,_,l,l,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,l,l,_,_,_,_
          _,_,_,_,_,l,_,_,_,_,_,_,_,_,_,_,_,_,_,l,l,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,l,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,l,l,l,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,l,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,l,ws3,w,sg0,w,ws1,l,w,l,_,_,w,_,_,_,_,_,_,_
          _,_,_,_,_,_,w,ws2,w,_,_,_,w,c,w,c,w,w,w,w,_,_,_,_,_,_
          _,_,_,_,_,_,cs3,w,_,_,_,_,_,_,_,_,w,_,_,w,w,_,_,_,_,_
          _,_,_,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,ws1,_,_,_,_,_
          _,_,_,_,_,_,cs3,_,_,ow,_,_,_,_,_,_,_,_,_,_,w,_,_,_,db,_
          _,_,_,_,_,_,w,_,_,ow,_,_,_,_,_,_,_,_,_,_,fg1,_,_,_,_,_
          _,_,db,_,_,_,cs3,_,_,ow,_,_,_,_,_,_,_,_,_,_,w,_,_,_,_,_
          _,_,_,_,_,l,w,_,_,_,_,_,_,_,_,_,_,_,_,_,ws1,_,_,_,_,_
          _,_,_,_,_,_,cs3,w,_,as0,as0,_,_,_,_,_,w,_,_,w,w,_,_,_,_,_
          _,_,_,_,_,_,w,ws0,w,_,_,_,w,w,w,w,w,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,l,_,w,sg0,w,_,l,w,l,bf13,_,_,bf13,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,_,_,l,w,_,_,_,w,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,l,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,l,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,l,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,w,sg0,w,_,_,w,_,_,_,w,_,_,_,_,_,_,_
          _,_,_,_,_,_,w,_,w,_,_,_,w,w,c,w,w,w,w,w,_,_,_,_,_,_
          _,_,_,_,_,_,w,w,_,_,_,_,_,_,_,_,ws3,ws5,ws7,ws1,w,_,_,_,_,_
          _,_,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,_,fg1,_,_,_,_,_
          _,_,_,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,db,_
          _,_,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,_,fg1,_,_,_,_,_
          _,_,db,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,_,_
          _,_,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,_,fg1,_,_,_,_,_
          _,_,_,_,_,_,w,w,_,_,_,_,_,_,_,_,ws3,ws5,ws7,ws1,w,_,_,_,_,_
          _,_,_,_,_,_,w,_,w,_,_,_,w,c,w,c,w,cs4,cs4,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,w,sg0,w,_,_,w,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,_,_,_,w,_,_,_,w,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,w,sg0,w,_,_,ws2,_,_,_,ws2,_,_,_,_,_,_,_
          _,_,_,_,_,_,w,_,w,_,_,_,w,w,c,c,w,w,w,c,_,_,_,_,_,_
          _,_,_,_,_,_,w,w,_,_,_,_,_,_,_,_,_,ws3,ws1,_,w,_,_,_,_,_
          _,_,_,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,fg1,_,_,_,_,_
          _,_,_,_,_,_,cs7,bs1,_,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,db,_
          _,_,l,_,_,_,w,bs1,_,_,_,_,_,_,_,_,_,_,_,_,fg1,_,_,_,_,_
          _,l,db,l,_,_,cs7,bs1,_,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,_,_
          _,_,l,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,fg1,_,_,_,_,_
          _,_,_,_,_,_,w,w,_,_,_,_,_,_,_,_,_,ws3,ws1,_,w,_,_,_,_,_
          _,_,_,_,_,_,w,_,w,_,_,_,w,w,w,w,c,c,c,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,w,sg0,w,_,_,ws0,_,bs3,cs5,cs7,bs1,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,_,_,_,w,_,_,_,bs3,cs5,cs7,bs1,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,bs3,bs5,bs7,bs1,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,ws7,w,sg0,w,ws5,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,w,_,w,_,_,_,w,c,w,w,w,w,w,w,_,_,_,_,_,_
          _,_,_,_,_,_,w,w,_,_,_,_,_,_,_,_,_,_,w,_,w,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,ws5,_,_,_,l,l
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,w,_,_,l,db,l
          _,_,l,l,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,fg1,_,_,_,l,_
          _,l,db,l,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,_,_
          _,l,l,l,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,ws5,_,_,_,_,_
          _,_,l,_,_,_,w,w,_,_,_,_,_,_,_,_,_,_,w,_,w,_,_,_,_,_
          _,_,_,_,_,_,w,_,w,_,_,_,w,w,w,c,w,w,w,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,ws7,w,sg0,w,ws5,_,_,_,_,bs3,bs1,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,bs0,bs0,bh0,bs0,bs0,_,_,_,_,bs3,bs1,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,bs3,bs1,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,ws2,ws2,ws2,w,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,ws3,_,w,w,w,w,w,w,fg0,w,fg0,w,fg0,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,_,_,_,_,_,_,_,_,_,w,w,_,_,_,_,l,_
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,l,l,l
          _,_,_,l,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,ws2,_,l,l,db,l
          _,l,l,l,l,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,ws5,_,_,l,l,l
          l,l,db,l,l,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,ws0,_,_,_,l,_
          l,l,l,l,l,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,_,_,_
          _,l,l,l,l,_,_,w,_,_,_,_,_,_,_,_,_,_,w,w,_,_,_,_,_,_
          _,_,l,_,_,_,ws3,_,w,w,w,w,w,w,fg0,w,fg0,w,fg0,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,bs0,bs0,bs0,w,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,ws3,_,w,w,fg0,w,w,w,fg0,w,fg0,w,fg0,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,_,_,_,_,_,_,_,_,_,w,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,_,l,_
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,l,l,_
          _,_,l,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,ws1,_,_,l,_,_
          _,l,l,l,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,_,_,_
          _,_,l,_,_,_,_,sg1,_,_,_,_,_,_,_,_,_,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,_,_,_,_,_,_,_,_,_,w,w,_,_,_,_,_,_
          _,_,_,_,_,_,ws3,_,w,w,fg0,w,w,w,fg0,w,fg0,w,fg0,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,w,_,_,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,bs2,bs2,_,bs2,bs2,_,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_,bs2,bs2,_,_,_,_,_
          _,_,_,_,_,bs4,w,ws6,w,w,_,w,w,w,ws6,w,ws6,w,ws6,w,bs4,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,_,_,_,_,_,_,db0,_,_,w,ws1,_,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,db0,_,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,db0,_,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,w,_,_,_,w,w,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,db0,_,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,_,_,_,_,db0,_,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,_,_,_,_,_,_,db0,_,_,w,ws1,_,_,_,_,_,_
          _,_,_,_,_,bs6,w,ws4,w,w,fg0,w,w,w,w,w,w,w,ws4,w,bs6,_,_,_,_,_
          _,_,_,_,_,bs0,bs0,_,bs0,bs0,_,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_,_,_,_,_
          _,_,_,_,_,bs4,w,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,w,bs4,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,_,_,db0,_,_,_,_,_,_,_,ws1,_,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,db0,_,_,_,_,_,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,w,_,_,_,db,_,_,_,sg1,_,_,_,_,_,_
          _,_,_,_,_,_,_,sg1,_,_,_,db0,_,_,_,_,_,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,_,_,db0,_,_,_,_,_,_,_,ws1,_,_,_,_,_,_
          _,_,_,_,_,bs6,w,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,w,bs6,_,_,_,_,_
          _,_,_,_,_,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_,_,_,_,_
          _,_,_,_,_,bs4,w,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,b,bs4,bs4,_,_,_,_
          _,_,_,_,_,_,_,bs5,_,_,_,dbs2,_,_,_,_,_,_,_,bs7,_,_,_,_,_,_
          _,_,_,_,_,_,_,bs5,_,_,_,db,_,_,_,db,_,_,_,bs7,_,_,_,_,_,_
          _,_,_,_,_,_,_,bs5,_,_,_,dbs0,_,_,_,_,_,_,_,bs7,_,_,_,_,_,_
          _,_,_,_,_,bs6,w,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,b,bs6,bs6,_,_,_,_
          _,_,_,_,_,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_,_,_,_,_
          _,_,_,_,_,bs4,w,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,bs4,ws1,bs4,_,_,_,_,_
          _,_,_,_,_,_,ws7,_,_,_,_,db,_,_,_,db,_,_,_,w,_,_,_,_,_,_
          _,_,_,_,_,bs6,w,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,bs6,ws1,bs6,_,_,_,_,_
          _,_,_,_,_,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,bs2,bs2,w,cs2,w,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,bs2,_,_,_,_,_
          _,_,_,_,_,bh0,w,w,w,w,w,w,w,w,w,w,w,w,w,w,bh0,_,_,_,_,_
          _,_,_,_,_,bs0,bs0,w,cs0,w,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,bs0,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,b,bh1,_,bf,_,bh1,bh1,bh1,bh1,bh1,bh1,bh1,bh1,bh1,bh1,b,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,bf,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,_,w,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,bf02,w,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,bf13,bf0123,bf13,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,w,bf02,w,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,cs2,_,cs2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,cs3,w,ws2,w,cs1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,ws3,_,ws1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,cs3,w,ws0,w,cs1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,cs0,_,cs0,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,cs2,ws6,cs2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,ws7,_,ws5,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,cs0,ws4,cs0,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,cs2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,cs3,c,cs1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,cs0,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
          `
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,cf,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_
          `,
        ],
        objects: {
          r: (size, displayedFaces) => new DirtWithGrass(size, displayedFaces),
          d: (size, displayedFaces) => new Dirt(size, displayedFaces),
          w: (size, displayedFaces) => new WallStone(size, displayedFaces),
          c: (size, displayedFaces) => new CobbleStone(size, displayedFaces),
          b: (size, displayedFaces) => new Bark(size, displayedFaces),
          db: (size, displayedFaces) => new DarkBark(size, displayedFaces),
          a: (size, displayedFaces) => new Wood(size, displayedFaces),
          t: (size, displayedFaces) => new WoodenTiles(size, displayedFaces),
          g: (size, displayedFaces) => new Gravel(size, displayedFaces),
          or: (size, displayedFaces) => new Wool(size, displayedFaces, "red"),
          ow: (size, displayedFaces) => new Wool(size, displayedFaces, "white"),
          l: (size) => new Leaves(size),
          db0: (size, displayedFaces) => createObject(DarkBark, size, 0, 1),
          db1: (size, displayedFaces) => createObject(DarkBark, size, 1, 1),
          cs0: (size) => createObject(CobbleStoneStairs, size, 0),
          cs1: (size) => createObject(CobbleStoneStairs, size, 1),
          cs2: (size) => createObject(CobbleStoneStairs, size, 2),
          cs3: (size) => createObject(CobbleStoneStairs, size, 3),
          cs4: (size) => createObject(CobbleStoneStairs, size, 0, 2),
          cs5: (size) => createObject(CobbleStoneStairs, size, 1, 2),
          cs7: (size) => createObject(CobbleStoneStairs, size, 3, 2),
          ws0: (size) => createObject(WallStoneStairs, size, 0),
          ws1: (size) => createObject(WallStoneStairs, size, 1),
          ws2: (size) => createObject(WallStoneStairs, size, 2),
          ws3: (size) => createObject(WallStoneStairs, size, 3),
          ws4: (size) => createObject(WallStoneStairs, size, 0, 2),
          ws5: (size) => createObject(WallStoneStairs, size, 1, 2),
          ws6: (size) => createObject(WallStoneStairs, size, 2, 2),
          ws7: (size) => createObject(WallStoneStairs, size, 3, 2),
          bs0: (size) => createObject(BarkStairs, size, 0),
          bs1: (size) => createObject(BarkStairs, size, 1),
          bs2: (size) => createObject(BarkStairs, size, 2),
          bs3: (size) => createObject(BarkStairs, size, 3),
          bs4: (size) => createObject(BarkStairs, size, 0, 2),
          bs5: (size) => createObject(BarkStairs, size, 1, 2),
          bs6: (size) => createObject(BarkStairs, size, 2, 2),
          bs7: (size) => createObject(BarkStairs, size, 3, 2),
          as0: (size) => createObject(WoodStairs, size, 0),
          as3: (size) => createObject(WoodStairs, size, 3),
          dbs0: (size) => createObject(DarkBarkStairs, size, 0),
          dbs2: (size) => createObject(DarkBarkStairs, size, 2),
          bh0: (size, displayedFaces) =>
            new BarkHalf(size, displayedFaces, "top"),
          bh1: (size, displayedFaces) =>
            new BarkHalf(size, displayedFaces, "bottom"),
          ah0: (size, displayedFaces) =>
            new WoodHalf(size, displayedFaces, "top"),
          ah1: (size, displayedFaces) =>
            new WoodHalf(size, displayedFaces, "bottom"),
          ch1: (size, displayedFaces) =>
            new CobbleStoneHalf(size, displayedFaces, "bottom"),
          sg0: (size) => createObject(StainedGlass, size, 0),
          sg1: (size) => createObject(StainedGlass, size, 1),
          fg0: (size) => createObject(FrostedGlass, size, 0),
          fg1: (size) => createObject(FrostedGlass, size, 1),
          d0: (size) => createObject(Door, size, 0),
          bf: (size) => new BarkFence(size),
          bf02: (size) => new BarkFence(size, [0, 2]),
          bf13: (size) => new BarkFence(size, [1, 3]),
          bf0123: (size) => new BarkFence(size, [0, 1, 2, 3]),
          cf: (size) => new CobbleStoneFence(size),
        },
        full: new Set([
          "r",
          "d",
          "w",
          "c",
          "b",
          "db",
          "a",
          "t",
          "g",
          "or",
          "ow",
          "db0",
          "db1",
        ]),
      };

      /*
       * LIBRARIES
       */
      /**
       * https://github.com/gre/bezier-easing
       * BezierEasing - use bezier curve for transition easing function
       * by Gaëtan Renaudeau 2014 - 2015 – MIT License
       */

      const cubicBezier = (() => {
        // These values are established by empiricism with tests (tradeoff: performance VS precision)
        var NEWTON_ITERATIONS = 4;
        var NEWTON_MIN_SLOPE = 0.001;
        var SUBDIVISION_PRECISION = 0.0000001;
        var SUBDIVISION_MAX_ITERATIONS = 10;

        var kSplineTableSize = 11;
        var kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);

        var float32ArraySupported = typeof Float32Array === "function";

        function A(aA1, aA2) {
          return 1.0 - 3.0 * aA2 + 3.0 * aA1;
        }
        function B(aA1, aA2) {
          return 3.0 * aA2 - 6.0 * aA1;
        }
        function C(aA1) {
          return 3.0 * aA1;
        }

        // Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.
        function calcBezier(aT, aA1, aA2) {
          return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT;
        }

        // Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.
        function getSlope(aT, aA1, aA2) {
          return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1);
        }

        function binarySubdivide(aX, aA, aB, mX1, mX2) {
          var currentX,
            currentT,
            i = 0;
          do {
            currentT = aA + (aB - aA) / 2.0;
            currentX = calcBezier(currentT, mX1, mX2) - aX;
            if (currentX > 0.0) {
              aB = currentT;
            } else {
              aA = currentT;
            }
          } while (
            Math.abs(currentX) > SUBDIVISION_PRECISION &&
            ++i < SUBDIVISION_MAX_ITERATIONS
          );
          return currentT;
        }

        function newtonRaphsonIterate(aX, aGuessT, mX1, mX2) {
          for (var i = 0; i < NEWTON_ITERATIONS; ++i) {
            var currentSlope = getSlope(aGuessT, mX1, mX2);
            if (currentSlope === 0.0) {
              return aGuessT;
            }
            var currentX = calcBezier(aGuessT, mX1, mX2) - aX;
            aGuessT -= currentX / currentSlope;
          }
          return aGuessT;
        }

        function LinearEasing(x) {
          return x;
        }

        function bezier(mX1, mY1, mX2, mY2) {
          if (!(0 <= mX1 && mX1 <= 1 && 0 <= mX2 && mX2 <= 1)) {
            throw new Error("bezier x values must be in [0, 1] range");
          }

          if (mX1 === mY1 && mX2 === mY2) {
            return LinearEasing;
          }

          // Precompute samples table
          var sampleValues = float32ArraySupported
            ? new Float32Array(kSplineTableSize)
            : new Array(kSplineTableSize);
          for (var i = 0; i < kSplineTableSize; ++i) {
            sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);
          }

          function getTForX(aX) {
            var intervalStart = 0.0;
            var currentSample = 1;
            var lastSample = kSplineTableSize - 1;

            for (
              ;
              currentSample !== lastSample && sampleValues[currentSample] <= aX;
              ++currentSample
            ) {
              intervalStart += kSampleStepSize;
            }
            --currentSample;

            // Interpolate to provide an initial guess for t
            var dist =
              (aX - sampleValues[currentSample]) /
              (sampleValues[currentSample + 1] - sampleValues[currentSample]);
            var guessForT = intervalStart + dist * kSampleStepSize;

            var initialSlope = getSlope(guessForT, mX1, mX2);
            if (initialSlope >= NEWTON_MIN_SLOPE) {
              return newtonRaphsonIterate(aX, guessForT, mX1, mX2);
            } else if (initialSlope === 0.0) {
              return guessForT;
            } else {
              return binarySubdivide(
                aX,
                intervalStart,
                intervalStart + kSampleStepSize,
                mX1,
                mX2
              );
            }
          }

          return function BezierEasing(x) {
            // Because JavaScript number are imprecise, we should guarantee the extremes are right.
            if (x === 0 || x === 1) {
              return x;
            }
            return calcBezier(getTForX(x), mY1, mY2);
          };
        }

        return bezier;
      })();

      /*
       * UTILS
       */
      const clamp = (num, min, max) => Math.min(Math.max(min, num), max);

      const textureLoader = new THREE.TextureLoader();

      const loadTexture = (
        dirName,
        textureName,
        type,
        extension = "jpg",
        repeat = [1, 1]
      ) => {
        const texture = textureLoader.load(
          `${TEXTURES_DIR}/x${TEXTURES_RESOLUTION}/${dirName}/${textureName}_${type}.${extension}`
        );
        texture.repeat.set(...repeat);
        texture.wrapS = THREE.RepeatWrapping;
        texture.wrapT = THREE.RepeatWrapping;
        return texture;
      };

      const loadSkybox = (dirName, textureName, extension = "jpg") =>
        Object.fromEntries(
          ["front", "back", "bottom", "top", "left", "right"].map((side) => [
            side,
            textureLoader.load(
              `${TEXTURES_DIR}/${dirName}/${textureName}_${side}.${extension}`
            ),
          ])
        );

      const loadTextures = (dirName, textureName, skipped = [], repeat) =>
        Object.fromEntries(
          [
            ["ambientOcclusion", "jpg"],
            ["baseColor", "jpg"],
            ["height", "png"],
            ["normal", "jpg"],
            ["roughness", "jpg"],
            ["metallic", "jpg"],
          ]
            .filter(([type, _]) => !skipped.includes(type))
            .map(([type, extension]) => [
              type,
              loadTexture(dirName, textureName, type, extension, repeat),
            ])
        );

      const createObject = (
        Constructor,
        size,
        yRotation = 0,
        zRotation = 0
      ) => {
        const stairs = new Constructor(size);
        stairs.rotation.y = (yRotation * Math.PI) / 2;
        stairs.rotation.z = (zRotation * Math.PI) / 2;
        return stairs;
      };

      class MinPriorityQueue {
        #heap = [];

        constructor(heap = []) {
          this.#heap = [...heap];
        }

        get length() {
          return this.#heap.length;
        }

        peek() {
          return this.#heap[0]?.value;
        }

        getAll() {
          return this.#heap.map(({ value }) => value);
        }

        enqueue(priority, value) {
          this.#heap.push({ priority, value });
          this.#heapifyUp(this.length - 1);
        }

        dequeue() {
          const removed = this.#heap[0].value;
          const last = this.#heap.pop();
          if (this.#heap.length > 0) {
            this.#heap[0] = last;
            this.#heapifyDown(0, this.#heap.length);
          }
          return removed;
        }

        clone() {
          return new MinPriorityQueue(this.#heap);
        }

        #swap(i, j) {
          [this.#heap[i], this.#heap[j]] = [this.#heap[j], this.#heap[i]];
        }

        #parentIdx(currentIdx) {
          return Math.floor(currentIdx - 1 / 2);
        }

        #leftChildIdx(currentIdx) {
          return 2 * currentIdx + 1;
        }

        #rightChildIdx(currentIdx) {
          return 2 * currentIdx + 2;
        }

        #heapifyUp(currentIdx, endIdx = 0) {
          while (currentIdx > endIdx) {
            const parentIdx = this.#parentIdx(currentIdx);
            if (
              this.#heap[currentIdx].priority < this.#heap[parentIdx].priority
            ) {
              this.#swap(currentIdx, parentIdx);
            }
            currentIdx = parentIdx;
          }
        }

        #heapifyDown(currentIdx, endIdx) {
          while (true) {
            const leftIdx = this.#leftChildIdx(currentIdx);
            const rightIdx = this.#rightChildIdx(currentIdx);
            let smallestIdx = currentIdx;

            if (leftIdx < endIdx) {
              if (
                this.#heap[leftIdx].priority < this.#heap[currentIdx].priority
              ) {
                smallestIdx = leftIdx;
              }
              if (
                rightIdx < endIdx &&
                this.#heap[rightIdx].priority < this.#heap[smallestIdx].priority
              ) {
                smallestIdx = rightIdx;
              }
            }

            if (smallestIdx !== currentIdx) {
              this.#swap(currentIdx, smallestIdx);
              currentIdx = smallestIdx;
            } else break;
          }
        }
      }

      class Easing {
        static linear() {
          return (t) => t;
        }

        static easeIn() {
          return cubicBezier(0.32, 0, 0.67, 0);
        }

        static easeOut() {
          return cubicBezier(0.22, 0.61, 0.36, 1);
        }

        static easeInOut() {
          return cubicBezier(0.45, 0.05, 0.55, 0.95);
        }

        static easeInOutBack() {
          return cubicBezier(0.68, -0.6, 0.32, 1.6);
        }

        static cubicBezier(mX1, mY1, mX2, mY2) {
          return cubicBezier(mX1, mY1, mX2, mY2);
        }
      }

      class Animation {
        static #clock = new THREE.Clock();

        #repeat = false;
        #totalDuration = 0;
        #allSteps = new MinPriorityQueue(); // priority is the begin time of the animation step
        #runningSteps = new MinPriorityQueue(); // priority is the end time of the animation step
        #remainingSteps = new MinPriorityQueue(); // part of the allSteps queue containing only animation steps that haven't begun
        #groupedAnimations = {};

        #status = "CREATED"; // CREATED, RUNNING, PAUSED, FINISHED
        #lastFrameTime = 0;
        #startTime = 0;

        // fillMode - FORWARDS, BACKWARDS, BOTH
        constructor(repeat = false) {
          this.#repeat = repeat;
        }

        play() {
          if (this.#status === "RUNNING") return;
          if (this.#status === "PAUSED" || this.#status === "CREATED") {
            this.#status = "RUNNING";
            this.#reset();
          }
          requestAnimationFrame(this.#update.bind(this));
        }

        pause() {
          this.#status = "PAUSED";
        }

        get status() {
          return this.#status;
        }

        add(animationName) {
          this.#groupedAnimations[animationName] = {
            startTime: this.#totalDuration,
          };
          return this;
        }

        to(object, toValues, config, animationName) {
          this.#createStep(object, null, toValues, config, animationName);
          return this;
        }

        from(object, fromValues, config, animationName) {
          this.#createStep(object, fromValues, null, config, animationName);
          return this;
        }

        run(fn, config, animationName) {
          this.#saveStep({
            fn,
            startTime: this.#calcStartTime(animationName, config?.delay),
            duration: config.duration,
            easing: config.easing || Easing.linear(),
            onUpdate: config.onUpdate,
            onFinish: config.onFinish,
          });
          return this;
        }

        #createStep(object, fromValues, toValues, config, animationName) {
          this.#saveStep({
            object,
            startTime: this.#calcStartTime(animationName, config?.delay),
            from: fromValues,
            to: toValues,
            duration: config.duration,
            easing: config.easing || Easing.linear(),
            onUpdate: config.onUpdate,
            onFinish: config.onFinish,
          });
        }

        #calcStartTime(animationName, delay) {
          return (
            (animationName && this.#groupedAnimations[animationName]
              ? this.#groupedAnimations[animationName].startTime
              : this.#totalDuration) + (delay || 0)
          );
        }

        #saveStep(step) {
          this.#totalDuration = step.startTime + step.duration;
          this.#allSteps.enqueue(step.startTime, step);
          this.#remainingSteps.enqueue(step.startTime, step);
        }

        #update() {
          for (const step of this.#runningSteps.getAll()) {
            this.#updateStep(step);
          }

          this.#updateRunningSteps();
          if (this.#status !== "RUNNING") return;
          requestAnimationFrame(this.#update.bind(this));
        }

        #updateStep(step) {
          const progress = this.#calcProgress(step);
          const { easing, onUpdate } = step;

          if (step.object) {
            Object.keys(step.from).forEach((key) => {
              step.object[key] =
                step.from[key] +
                (step.to[key] - step.from[key]) * easing(progress);
            });
          } else {
            step.fn(progress);
          }

          onUpdate?.(progress);
        }

        #updateRunningSteps() {
          const elapsed = Animation.#clock.getElapsedTime() - this.#startTime;

          while (this.#calcProgress(this.#runningSteps.peek()) === 1) {
            this.#runningSteps.peek().onFinish?.();
            this.#runningSteps.dequeue();
          }

          while (this.#remainingSteps.peek()?.startTime <= elapsed) {
            const step = { ...this.#remainingSteps.dequeue() };
            if (step.from) {
              step.to = Object.fromEntries(
                Object.keys(step.from).map((key) => [key, step.object[key]])
              );
            } else if (step.to) {
              step.from = Object.fromEntries(
                Object.keys(step.to).map((key) => [key, step.object[key]])
              );
            }
            this.#runningSteps.enqueue(step.startTime + step.duration, step);
          }

          if (!this.#runningSteps.peek() && !this.#remainingSteps.peek()) {
            this.#status = "FINISHED";
            if (this.#repeat) this.play();
          }
        }

        #calcProgress(step) {
          if (!step) return 0;
          const elapsed = Animation.#clock.getElapsedTime() - step.startTime;
          const progress = elapsed / step.duration;
          return clamp(progress, 0, 1);
        }

        #reset() {
          const currentElapsed = Animation.#clock.getElapsedTime();
          this.#remainingSteps = this.#allSteps.clone();
          this.#lastFrameTime = currentElapsed;
          this.#startTime = currentElapsed;
        }
      }

      class InputController {
        #keys = {};
        #previousKeys = {};

        constructor() {
          this.#initialize();
        }

        isPressed(...keys) {
          return keys.some((key) => this.#keys[key]);
        }

        update() {
          this.previous = JSON.parse(JSON.stringify(this.current));
        }

        #initialize() {
          this.current = {
            mouse: {
              left: false,
              right: false,
              x: 0,
              y: 0,
              deltaX: 0,
              deltaY: 0,
            },
          };
          this.previous = JSON.parse(JSON.stringify(this.current));

          document.addEventListener(
            "mousedown",
            this.#handleMouseDown.bind(this)
          );
          document.addEventListener("mouseup", this.#handleMouseUp.bind(this));
          document.addEventListener(
            "mousemove",
            this.#handleMouseMove.bind(this)
          );
          document.addEventListener("keydown", this.#handleKeydown.bind(this));
          document.addEventListener("keyup", this.#handleKeyUp.bind(this));
        }

        #handleMouseDown(e) {
          switch (e.button) {
            case 0:
              this.current.mouse.left = true;
              break;
            case 2:
              this.current.mouse.right = true;
              break;
          }
        }

        #handleMouseUp(e) {
          switch (e.button) {
            case 0:
              this.current.mouse.left = false;
              break;
            case 2:
              this.current.mouse.right = false;
              break;
          }
        }

        #handleMouseMove(e) {
          this.current.mouse.x = e.x - window.innerWidth / 2;
          this.current.mouse.y = e.y - window.innerHeight / 2;
          this.current.mouse.deltaX =
            this.current.mouse.x - this.previous.mouse.x;
          this.current.mouse.deltaY =
            this.current.mouse.y - this.previous.mouse.y;
          this.update();
        }

        #handleKeydown(e) {
          this.#keys[e.key] = true;
        }

        #handleKeyUp(e) {
          this.#keys[e.key] = false;
        }
      }

      class FirstPersonCamera {
        #camera = null;
        #inputController = null;
        #translation = null;
        #rotation = new THREE.Quaternion();
        #phi = 0;
        #theta = 0;
        #thetaSpeed = 0.5;
        #headActive = false;
        #headTimer = 0;
        #lastUpdateTime = 0;
        static #clock = new THREE.Clock();

        constructor(camera) {
          this.#camera = camera;
          this.#inputController = new InputController();
          const { x, y, z } = camera.position;
          this.#translation = new THREE.Vector3(x, y, z);
          this.#lastUpdateTime = FirstPersonCamera.#clock.getElapsedTime();
        }

        update() {
          const currentTime = FirstPersonCamera.#clock.getElapsedTime();
          const timeElapsed = currentTime - this.#lastUpdateTime;
          this.#updateRotation(timeElapsed);
          this.#updateCamera(timeElapsed);
          this.#updateTranslation(timeElapsed);
          this.#updateHeadPosition(timeElapsed);
          this.#inputController.update(timeElapsed);
          this.#lastUpdateTime = currentTime;
        }

        #updateHeadPosition(timeElapsed) {
          if (this.#headActive) {
            const waveLength = Math.PI;
            const nextStep =
              1 + Math.floor(((this.#headTimer + 0.000001) * 10) / waveLength);
            const nextStepTime = (nextStep * waveLength) / 10;
            this.#headTimer = Math.min(
              this.#headTimer + timeElapsed,
              nextStepTime
            );

            if (this.#headTimer === nextStepTime) {
              this.#headActive = false;
            }
          }
        }

        #updateTranslation(timeElapsed) {
          const forwardVelocity = this.#inputController.isPressed(
            "w",
            "ArrowUp"
          )
            ? 1
            : 0 + this.#inputController.isPressed("s", "ArrowDown")
            ? -1
            : 0;
          const strafeVelocity = this.#inputController.isPressed(
            "a",
            "ArrowLeft"
          )
            ? 1
            : 0 + this.#inputController.isPressed("d", "ArrowRight")
            ? -1
            : 0;

          const qx = new THREE.Quaternion();
          qx.setFromAxisAngle(new THREE.Vector3(0, 1, 0), this.#phi);

          const forwardVector = new THREE.Vector3(0, 0, -1);
          forwardVector.applyQuaternion(qx);
          forwardVector.multiplyScalar(forwardVelocity * timeElapsed * 10);

          const leftVector = new THREE.Vector3(-1, 0, 0);
          leftVector.applyQuaternion(qx);
          leftVector.multiplyScalar(strafeVelocity * timeElapsed * 10);

          this.#translation.add(forwardVector);
          this.#translation.add(leftVector);

          if (forwardVelocity != 0 || strafeVelocity != 0) {
            this.#headActive = true;
          }
        }

        #updateRotation(timeElapsed) {
          const xh =
            this.#inputController.current.mouse.deltaX / window.innerWidth;
          const yh =
            this.#inputController.current.mouse.deltaY / window.innerHeight;

          this.#phi -= 5 * xh;
          this.#theta = clamp(this.#theta - 5 * yh, -Math.PI / 3, Math.PI / 3);

          const qx = new THREE.Quaternion();
          qx.setFromAxisAngle(new THREE.Vector3(0, 1, 0), this.#phi);
          const qz = new THREE.Quaternion();
          qz.setFromAxisAngle(new THREE.Vector3(1, 0, 0), this.#theta);

          const q = new THREE.Quaternion();
          q.multiply(qx);
          q.multiply(qz);

          this.#rotation.copy(q);
        }

        #updateCamera(timeElapsed) {
          this.#camera.quaternion.copy(this.#rotation);
          this.#camera.position.copy(this.#translation);
          this.#camera.position.y += Math.sin(this.#headTimer * 25) * 0.1;
        }
      }

      /*
       * SETUP
       */
      // Canvas
      const canvas = document.getElementById("webgl");

      // Scene
      const scene = new THREE.Scene();

      // GUI
      // const guiControls = {
      //   rotate: false,
      // };

      // const gui = new dat.GUI();
      // gui.add(guiControls, "rotate");

      // Statistics
      const stats = new Stats();
      stats.setMode(0);
      stats.domElement.style.position = "absolute";
      stats.domElement.style.left = "0px";
      stats.domElement.style.top = "0px";
      document.getElementById("stats").appendChild(stats.domElement);

      // Helpers
      // const axesHelper = new THREE.AxesHelper(25);
      // scene.add(axesHelper);

      /*
       * SIZES
       */
      const SIZES = {
        window: {
          width: window.innerWidth,
          height: window.innerHeight,
        },
      };

      /*
       * TEXTURES
       */
      const TEXTURES = {
        dirt: loadTextures("dirt", "dirt", ["metallic"]),
        grass: loadTextures("grass", "grass", ["metallic"]),
        dirtWithGrass: loadTextures("dirt_with_grass", "dirt_with_grass", [
          "metallic",
        ]),
        gravel: loadTextures("gravel", "gravel", ["metallic"]),
        wood: loadTextures("wood", "wood", ["metallic"]),
        stone: loadTextures("stone", "stone", ["metallic"]),
        cobblestone: loadTextures("cobblestone", "cobblestone", ["metallic"]),
        bark: {
          default: loadTextures("bark", "bark", ["metallic"]),
          dark: {
            ...loadTextures("bark", "bark", ["metallic"]),
            baseColor: loadTexture("bark", "bark_dark", "basecolor", "jpg"),
          },
        },
        wool: {
          red: loadTextures("wool", "wool_red", ["metallic"]),
          white: loadTextures("wool", "wool_white", ["metallic"]),
        },
        tiles: {
          wooden: loadTextures("tiles_wooden", "tiles_wooden", ["metallic"]),
        },
        leaves: {
          texture: loadTextures("leaves", "leaves", ["metallic"]),
          alpha: loadTexture("leaves", "leaves", "transparency", "jpg"),
        },
        glass: {
          stained: {
            texture: loadTextures("glass", "glass_stained"),
            alpha: loadTexture("glass", "glass_stained", "transparency", "jpg"),
          },
          frosted: {
            texture: loadTextures("glass", "glass_frosted", ["metallic"]),
            alpha: loadTexture("glass", "glass_frosted", "transparency", "jpg"),
          },
        },
        door: {
          front: loadTextures("door", "door_front", [], [1, 2]),
          side: loadTextures("door", "door_side", [], [1, 2]),
          top: loadTextures("door", "door_top", [], [1, 1]),
        },
        stairsHeight: {
          bark: loadTexture("bark", "bark_stairs", "height", "png"),
          cobblestone: loadTexture(
            "cobblestone",
            "cobblestone_stairs",
            "height",
            "png"
          ),
          stone: loadTexture("stone", "stone_stairs", "height", "png"),
        },
        skybox: loadSkybox("skybox", "clouds"),
      };

      /*
       * COLORS
       */
      const COLORS = {
        white: 0xffffff,
      };

      /*
       * MATERIALS
       */
      const MATERIALS = {
        cache: {},
      };

      /*
       * GEOMETRIES
       */
      const GEOMETRIES = {
        cache: {},
      };

      class StairsGeometry extends THREE.BufferGeometry {
        constructor(width, height, depth, stepsCount) {
          super();
          const vertices = this.#createVertices(
            width,
            height,
            depth,
            stepsCount
          );
          const joints = this.#joinVertices(stepsCount);
          const positions = joints
            .flatMap((ids) => ids.flatMap((id) => vertices[id]))
            .map((p) => p - 0.5);
          const uvs = this.#createUVs(vertices, joints, width, height, depth);

          this.setAttribute(
            "position",
            new THREE.Float32BufferAttribute(positions, 3)
          );
          this.setAttribute("uv", new THREE.Float32BufferAttribute(uvs, 2));
          this.computeVertexNormals();
        }

        #createVertices(width, height, depth, stepsCount) {
          const vertices = [];
          const stepHeight = height / stepsCount;
          const stepDepth = depth / stepsCount;

          for (let i = 0; i <= stepsCount; i++) {
            vertices.push([0, i * stepHeight, 0]);
            vertices.push([width, i * stepHeight, 0]);

            if (i < stepsCount) {
              vertices.push([0, i * stepHeight, depth - i * stepDepth]);
              vertices.push([width, i * stepHeight, depth - i * stepDepth]);
            }

            if (i > 0) {
              vertices.push([0, i * stepHeight, depth - (i - 1) * stepDepth]);
              vertices.push([
                width,
                i * stepHeight,
                depth - (i - 1) * stepDepth,
              ]);
            }
          }

          return vertices;
        }

        #joinVertices(stepsCount) {
          const joints = [];

          joints.push(
            [0, 1, 2],
            [2, 1, 3],
            [0, 4, 1],
            [1, 4, 5],
            [1, 5, 3],
            [3, 5, 9],
            [0, 2, 8],
            [0, 8, 4],
            [2, 3, 8],
            [3, 9, 8]
          );

          let i = 1;
          for (; i < stepsCount - 1; i++) {
            joints.push(
              this.#join3Vertices(i, 0, 6, 1),
              this.#join3Vertices(i, 1, 6, 7),
              this.#join3Vertices(i, 1, 7, 3),
              this.#join3Vertices(i, 3, 7, 11),
              this.#join3Vertices(i, 0, 2, 6),
              this.#join3Vertices(i, 2, 10, 6),
              this.#join3Vertices(i, 2, 3, 10),
              this.#join3Vertices(i, 3, 11, 10),
              this.#join3Vertices(i, 2, 4, 3),
              this.#join3Vertices(i, 3, 4, 5)
            );
          }

          joints.push(
            this.#join3Vertices(i, 0, 6, 1),
            this.#join3Vertices(i, 1, 6, 7),
            this.#join3Vertices(i, 1, 7, 3),
            this.#join3Vertices(i, 3, 7, 9),
            this.#join3Vertices(i, 0, 2, 6),
            this.#join3Vertices(i, 2, 8, 6),
            this.#join3Vertices(i, 2, 3, 8),
            this.#join3Vertices(i, 3, 9, 8),
            this.#join3Vertices(i, 2, 4, 3),
            this.#join3Vertices(i, 3, 4, 5),
            this.#join3Vertices(i, 6, 8, 7),
            this.#join3Vertices(i, 7, 8, 9)
          );

          return joints;
        }

        #join3Vertices(level, a, b, c) {
          return [6 * level + a - 2, 6 * level + b - 2, 6 * level + c - 2];
        }

        #createUVs(vertices, joints, width, height, depth) {
          const uvs = [];

          for (let i = 0; i < joints.length; i++) {
            const [v1, v2, v3] = joints[i].map((id) => vertices[id]);
            if (v1[0] === v2[0] && v2[0] === v3[0]) {
              uvs.push(v1[2] / depth, v1[1] / height);
              uvs.push(v2[2] / depth, v2[1] / height);
              uvs.push(v3[2] / depth, v3[1] / height);
            } else if (v1[1] === v2[1] && v2[1] === v3[1]) {
              uvs.push(v1[0] / width, v1[2] / depth);
              uvs.push(v2[0] / width, v2[2] / depth);
              uvs.push(v3[0] / width, v3[2] / depth);
            } else {
              uvs.push(v1[0] / width, v1[1] / height);
              uvs.push(v2[0] / width, v2[1] / height);
              uvs.push(v3[0] / width, v3[1] / height);
            }
          }

          return uvs;
        }
      }

      /*
       * OBJECTS
       */
      class ObjectWithTexture extends THREE.Mesh {
        constructor(geometry, materials) {
          super(geometry, materials);

          this.castShadow = true;
          this.receiveShadow = true;
        }

        static parseTextures(textures, displayedFaces) {
          let texturesArray = textures;
          if (!(textures instanceof Array))
            texturesArray = new Array(6).fill(0).map((_) => textures);
          return texturesArray.map((texture, idx) =>
            displayedFaces.includes(idx) ? texture : null
          );
        }

        static createMaterial(key, id, type, texture, settings) {
          const cacheKey = `${key}-${id}`;
          if (!MATERIALS.cache[cacheKey]) {
            const maps = {
              map: texture.baseColor,
              aoMap: texture.ambientOcclusion,
            };

            if (texture.metallnessMap) {
              maps.metallnessMap = texture.metallnessMap;
              maps.metalness = 0.5;
            }

            if (type === "standard") {
              maps.roughnessMap = texture.roughness;
              maps.roughness = 0.5;
              maps.displacementMap = texture.height;
              maps.displacementScale = 0.1;
              maps.normalMap = texture.normal;
            }

            Object.assign(maps, settings);

            let material;
            switch (type) {
              case "phong":
                material = new THREE.MeshPhongMaterial(maps);
                break;
              case "lambert":
                material = new THREE.MeshLambertMaterial(maps);
                break;
              case "standard":
              default:
                material = new THREE.MeshStandardMaterial(maps);
            }

            MATERIALS.cache[cacheKey] = material;
          }
          return MATERIALS.cache[cacheKey];
        }

        static createMaterials(key, type, textures, settings) {
          return textures.map(
            (texture, idx) =>
              texture &&
              ObjectWithTexture.createMaterial(
                key,
                idx,
                type,
                texture,
                settings[idx] || settings.all
              )
          );
        }
      }

      class Block extends ObjectWithTexture {
        constructor(
          key,
          size,
          textures,
          displayedFaces = [0, 1, 2, 3, 4, 5],
          segments = 16 * SEGMENTS_FACTOR,
          materialType = "standard",
          materialSettings = {}
        ) {
          const width = size.width || size;
          const height = size.height || size;
          const depth = size.depth || size;

          const geometry = Block.#createGeometry(
            key,
            width,
            height,
            depth,
            segments
          );
          const materials = ObjectWithTexture.createMaterials(
            key,
            materialType,
            ObjectWithTexture.parseTextures(textures, displayedFaces),
            materialSettings
          );
          super(geometry, materials);
        }

        static #createGeometry(key, width, height, depth, segments) {
          const cacheKey = `${key}-${width}-${height}-${depth}-${segments}`;

          if (!GEOMETRIES.cache[cacheKey]) {
            const geometry = new THREE.BoxBufferGeometry(
              width,
              height,
              depth,
              segments,
              segments,
              segments
            );
            const uvs = geometry.attributes.uv.array;
            geometry.setAttribute("uv2", new THREE.BufferAttribute(uvs, 2));
            GEOMETRIES.cache[cacheKey] = geometry;
          }

          return GEOMETRIES.cache[cacheKey];
        }
      }

      class Stairs extends ObjectWithTexture {
        constructor(key, size, texture, materialSettings) {
          const geometry = new StairsGeometry(size, size, size, 2);
          const uvs = geometry.attributes.uv.array;
          const material = ObjectWithTexture.createMaterial(
            key,
            0,
            "standard",
            texture,
            materialSettings
          );
          super(geometry, material);
        }
      }

      class BlockHalf extends Block {
        constructor(
          key,
          size,
          textures,
          displayedFaces = [0, 1, 2, 3, 4, 5],
          side = "top"
        ) {
          if (side === "top" && !displayedFaces.includes(2))
            displayedFaces.push(2);
          else if (!displayedFaces.includes(3)) displayedFaces.push(3);

          super(
            key,
            {
              width: size,
              height: size / 2,
              depth: size,
            },
            textures,
            displayedFaces,
            8 * SEGMENTS_FACTOR
          );

          if (side === "top") {
            this.position.y += size / 4;
          } else {
            this.position.y -= size / 4;
          }
        }
      }

      class Fence extends THREE.Group {
        constructor(key, size, texture, connectedSides = [], jointsCount = 2) {
          super();
          this.key = key;
          this.texture = texture;
          this.size = size;

          this.add(this.#createPal(1, size));

          for (let side of connectedSides) {
            const joints = this.#createJoints(size, jointsCount);
            joints.rotation.y = (Math.PI / 2) * side;
            this.add(joints);
          }
        }

        #createJoints(side, jointsCount) {
          const group = new THREE.Group();

          for (let i = 0; i < jointsCount; i++) {
            const joint = this.#createPal(0.5, 0.4 * this.size);
            joint.rotateZ(Math.PI / 2);
            joint.position.y = (i * this.size) / (jointsCount + 1);
            joint.position.x = 0.3 * this.size;
            group.add(joint);
          }

          group.position.y -= this.size / (jointsCount + 1) / 2;

          return group;
        }

        #createPal(scale, height) {
          return new Block(
            this.key,
            {
              width: (this.size * scale) / 5,
              height,
              depth: (this.size * scale) / 5,
            },
            this.texture,
            undefined,
            4 * SEGMENTS_FACTOR,
            "standard",
            {
              all: {
                displacementScale: 0.05 * scale,
              },
              2: {
                displacementScale: 0,
              },
              3: {
                displacementScale: 0,
              },
            }
          );
        }
      }

      class Dirt extends Block {
        constructor(size, displayedFaces) {
          super("dirt", size, TEXTURES.dirt, displayedFaces);
        }
      }

      class DirtWithGrass extends Block {
        constructor(size, displayedFaces) {
          super(
            "dirt-with-grass",
            size,
            [
              TEXTURES.dirtWithGrass,
              TEXTURES.dirtWithGrass,
              TEXTURES.grass,
              TEXTURES.dirt,
              TEXTURES.dirtWithGrass,
              TEXTURES.dirtWithGrass,
            ],
            displayedFaces,
            undefined,
            "standard",
            {
              2: {
                displacementScale: 0.25,
              },
            }
          );
        }
      }

      class Gravel extends Block {
        constructor(size, displayedFaces) {
          super("gravel", size, TEXTURES.gravel, displayedFaces);
        }
      }

      class Leaves extends Block {
        constructor(size, displayedFaces) {
          super(
            "leaves",
            size,
            TEXTURES.leaves.texture,
            displayedFaces,
            32 * SEGMENTS_FACTOR,
            "standard",
            {
              all: {
                displacementScale: 0.15,
                transparent: true,
                alphaMap: TEXTURES.leaves.alpha,
                side: THREE.DoubleSide,
              },
            }
          );
        }
      }

      class WallStone extends Block {
        constructor(size, displayedFaces) {
          super(
            "wall-stone",
            size,
            TEXTURES.stone,
            displayedFaces,
            4 * SEGMENTS_FACTOR
          );
        }
      }

      class CobbleStone extends Block {
        constructor(size, displayedFaces) {
          super(
            "cobblestone",
            size,
            TEXTURES.cobblestone,
            displayedFaces,
            undefined,
            "standard",
            { all: { displacementScale: 0.5 } }
          );
        }
      }

      class Bark extends Block {
        constructor(size, displayedFaces) {
          super("bark-default", size, TEXTURES.bark.default, displayedFaces);
        }
      }

      class DarkBark extends Block {
        constructor(size, displayedFaces) {
          super("bark-dark", size, TEXTURES.bark.dark, displayedFaces);
        }
      }

      class Wood extends Block {
        constructor(size, displayedFaces) {
          super("wood", size, TEXTURES.wood, displayedFaces);
        }
      }

      class WoodenTiles extends Block {
        constructor(size, displayedFaces) {
          super(
            "wooden-tiles",
            size,
            TEXTURES.tiles.wooden,
            displayedFaces,
            8 * SEGMENTS_FACTOR
          );
        }
      }

      class Wool extends Block {
        constructor(size, displayedFaces, color = "red") {
          super(
            `$wool-${color}`,
            size,
            TEXTURES.wool[color],
            displayedFaces,
            8 * SEGMENTS_FACTOR
          );
        }
      }

      class Glass extends Block {
        constructor(key, size, texture, settings) {
          super(
            key,
            {
              width: size,
              height: size,
              depth: size / 10,
            },
            texture,
            [4, 5],
            undefined,
            "standard",
            {
              all: {
                metalness: 0.2,
                displacementScale: 0.1,
                roughness: 0.5,
                transparent: true,
                ...settings,
              },
            }
          );
        }
      }

      class StainedGlass extends Glass {
        constructor(size) {
          super("stained-glass", size, TEXTURES.glass.stained.texture, {
            alphaMap: TEXTURES.glass.stained.alpha,
          });
        }
      }

      class FrostedGlass extends Glass {
        constructor(size) {
          super("frosted-glass", size, TEXTURES.glass.frosted.texture, {
            alphaMap: TEXTURES.glass.frosted.alpha,
          });
        }
      }

      class Door extends Block {
        constructor(size) {
          super("door", { width: size, height: 2 * size, depth: size / 5 }, [
            TEXTURES.door.side,
            TEXTURES.door.side,
            TEXTURES.door.top,
            TEXTURES.door.top,
            TEXTURES.door.front,
            TEXTURES.door.front,
          ]);
          this.position.y += size / 2;
        }
      }

      class BarkHalf extends BlockHalf {
        constructor(size, displayedFaces, side) {
          super("bark", size, TEXTURES.bark.default, displayedFaces, side);
        }
      }

      class WoodHalf extends BlockHalf {
        constructor(size, displayedFaces, side) {
          super("wood", size, TEXTURES.wood, displayedFaces, side);
        }
      }

      class CobbleStoneHalf extends BlockHalf {
        constructor(size, displayedFaces, side) {
          super(
            "cobblestone",
            size,
            TEXTURES.cobblestone,
            displayedFaces,
            side
          );
        }
      }

      class WallStoneStairs extends Stairs {
        constructor(size) {
          super("wall-stone-stairs", size, TEXTURES.stone, {
            displacementMap: TEXTURES.stairsHeight.stone,
          });
        }
      }

      class CobbleStoneStairs extends Stairs {
        constructor(size) {
          super("cobblestone-stairs", size, TEXTURES.cobblestone, {
            displacementMap: TEXTURES.stairsHeight.cobblestone,
          });
        }
      }

      class BarkStairs extends Stairs {
        constructor(size) {
          super("bark-stairs", size, TEXTURES.bark.default, {
            displacementMap: TEXTURES.stairsHeight.bark,
          });
        }
      }

      class DarkBarkStairs extends Stairs {
        constructor(size) {
          super("dark-bark-stairs", size, TEXTURES.bark.dark, {
            displacementMap: TEXTURES.stairsHeight.bark,
          });
        }
      }

      class WoodStairs extends Stairs {
        constructor(size) {
          super("wooden-stairs", size, TEXTURES.wood, {
            displacementMap: TEXTURES.stairsHeight.bark,
          });
        }
      }

      class BarkFence extends Fence {
        constructor(size, connectedSides) {
          super("bark-fence", size, TEXTURES.bark.default, connectedSides);
        }
      }

      class CobbleStoneFence extends Fence {
        constructor(size, connectedSides) {
          super(
            "cobblestone-fence",
            size,
            TEXTURES.cobblestone,
            connectedSides
          );
        }
      }

      class ReflectiveSphere extends THREE.Group {
        static spheres = new Set();

        constructor(
          size,
          segments = 50,
          near = 1,
          far = 10000,
          distance = 500
        ) {
          super();
          this.cubeCamera = new THREE.CubeCamera(near, far, distance);
          const geometry = new THREE.SphereGeometry(size, segments, segments);
          const material = new THREE.MeshBasicMaterial({
            envMap: this.cubeCamera.renderTarget,
          });
          this.mirrorSphere = new THREE.Mesh(geometry, material);
          this.add(this.cubeCamera);
          this.add(this.mirrorSphere);
        }

        track() {
          ReflectiveSphere.spheres.add(this);
        }

        remove() {
          super.remove(this.mirrorSphere);
          super.remove(this.cubeCamera);
          scene.remove(this);
          ReflectiveSphere.spheres.delete(this);
        }

        static update() {
          ReflectiveSphere.spheres.forEach((sphere) => {
            sphere.cubeCamera.update(renderer, scene);
          });
        }
      }

      class Construction extends THREE.Group {
        constructor(data, blockSize, settings = {}) {
          super();
          this.settings = settings;
          this.storedObjects = {};
          this.data = data;
          this.parsedLayers = this.#parseLayers(data.layers);
          this.ySegments = data.layers.length;
          this.zSegments = this.parsedLayers[0].length;
          this.xSegments = this.parsedLayers[0][0].length;
          const layersGroup = this.#createLayers(data, blockSize);
          layersGroup.position.y += blockSize / 2;
          layersGroup.position.x -= ((this.xSegments - 1) * blockSize) / 2;
          layersGroup.position.z -= ((this.zSegments - 1) * blockSize) / 2;
          this.add(layersGroup);
        }

        getObjects(symbol) {
          return this.storedObjects[symbol];
        }

        #parseLayerText(text) {
          return text
            .split("\n")
            .map((row) => row.trim())
            .filter(Boolean)
            .map((row) => {
              let rowArray = row.split(",");
              if (!(rowArray instanceof Array)) rowArray = row.split("");
              return rowArray;
            });
        }

        #parseLayers(layers) {
          return layers.map((layer) =>
            layer instanceof Array ? layer : this.#parseLayerText(layer)
          );
        }

        #createLayers(data, blockSize) {
          const layersGroup = new THREE.Group();
          this.parsedLayers.map((layer, y) => {
            const layerGroup = new THREE.Group();
            layer.forEach((row, z) => {
              row.forEach((symbol, x) => {
                if (symbol === "_") return;
                const displayedFaces = this.#getDisplayedFaces(x, y, z);
                if (!displayedFaces.length) return;
                try {
                  const object = data.objects[symbol](
                    blockSize,
                    displayedFaces
                  );
                  const position = this.#getPosition(x, y, z, blockSize);
                  object.position.set(
                    position.x,
                    object.position.y + position.y,
                    position.z
                  );
                  layerGroup.add(object);

                  if (this.settings.storeObjects?.has(symbol)) {
                    if (!this.storedObjects[symbol]) {
                      this.storedObjects[symbol] = [];
                    }
                    this.storedObjects[symbol].push(object);
                  }
                } catch (e) {
                  console.error(
                    `'${symbol}' (${x}, ${y}, ${z}) is not recognized: ` + e
                  );
                }
              });
              layersGroup.add(layerGroup);
            });
          });
          return layersGroup;
        }

        #getDisplayedFaces(x, y, z) {
          const displayedFaces = [];

          if (this.#isEmpty(x, y, z - 1)) displayedFaces.push(5); // back side
          if (this.#isEmpty(x, y, z + 1)) displayedFaces.push(4); // front side
          if (this.#isEmpty(x, y - 1, z)) displayedFaces.push(3); // bottom side
          if (this.#isEmpty(x, y + 1, z)) displayedFaces.push(2); // top side
          if (this.#isEmpty(x - 1, y, z)) displayedFaces.push(1); // left side
          if (this.#isEmpty(x + 1, y, z)) displayedFaces.push(0); // right side

          return displayedFaces;
        }

        #getPosition(x, y, z, blockSize) {
          return new THREE.Vector3(x * blockSize, y * blockSize, z * blockSize);
        }

        #isEmpty(x, y, z) {
          return (
            x < 0 ||
            x >= this.xSegments ||
            y < 0 ||
            y >= this.ySegments ||
            z < 0 ||
            z >= this.zSegments ||
            this.#isEmptySymbol(this.parsedLayers[y][z][x])
          );
        }

        #isEmptySymbol(symbol) {
          return symbol === "_" || !this.data.full.has(symbol);
        }
      }

      /*
       * SKYBOX
       */
      const skybox = new THREE.Mesh(
        new THREE.BoxGeometry(10000, 10000, 10000),
        ["right", "left", "top", "bottom", "front", "back"].map(
          (side) =>
            new THREE.MeshBasicMaterial({
              map: TEXTURES.skybox[side],
              side: THREE.BackSide,
            })
        )
      );
      skybox.rotation.y = -Math.PI / 2;
      scene.add(skybox);
      /*
       * LIGHTS
       */
      const lightUtilsMixin = {
        _target: new THREE.Object3D(),

        init(position, target, applySettings) {
          if (position) this.setPosition(position);
          if (target) this.setTarget(target);
          applySettings?.(this);
          scene.add(this._target);
        },

        setTarget(target) {
          if (target instanceof THREE.Vector3) {
            this._target.position.copy(target);
            this.target = this._target;
          } else {
            this.target = target;
          }
        },

        setPosition(position) {
          this.position.copy(position);
        },

        updateHelper() {
          this.target.updateMatrixWorld();
        },
      };

      class AmbientLight extends THREE.AmbientLight {
        constructor(color, intensity = 1) {
          super(color, intensity);
        }
      }

      class DirectionalLight extends THREE.DirectionalLight {
        #helper = null;

        constructor(color, intensity, position, target, applySettings) {
          super(color, intensity);
          this.init(position, target, applySettings);
        }

        showHelper(size = 5) {
          if (this.#helper) {
            this.#helper.dispose();
            scene.remove(this.#helper);
          }
          this.target.updateMatrixWorld();
          this.#helper = new THREE.DirectionalLightHelper(this, size);
          scene.add(this.#helper);
        }
      }

      class SpotLight extends THREE.SpotLight {
        #helper = null;

        constructor(
          color,
          intensity,
          distance,
          angle,
          position,
          target,
          penumbra,
          decay,
          applySettings
        ) {
          super(color, intensity, distance, angle, penumbra, decay);
          this.init(position, target, applySettings);
        }

        showHelper() {
          if (this.#helper) {
            this.#helper.dispose();
            scene.remove(this.#helper);
          }
          this.target.updateMatrixWorld();
          this.#helper = new THREE.SpotLightHelper(this);
          scene.add(this.#helper);
        }
      }

      Object.assign(DirectionalLight.prototype, lightUtilsMixin);
      Object.assign(SpotLight.prototype, lightUtilsMixin);

      const LIGHTS = {
        ambient: new AmbientLight(COLORS.white, 0.5),
        directional: [
          new DirectionalLight(
            COLORS.white,
            0.5,
            new THREE.Vector3(-35, 60, 15),
            new THREE.Vector3(-8, 14, -1),
            (instance) => {
              instance.castShadow = true;
              instance.shadow.radius = 5;
            }
          ),
        ],
        spot: [
          new SpotLight(
            COLORS.white,
            1,
            500,
            0.25,
            new THREE.Vector3(-40, 30, 10),
            new THREE.Vector3(-4, 30, -1),
            undefined,
            undefined,
            (instance) => {
              instance.castShadow = true;
            }
          ),
          new SpotLight(
            COLORS.white,
            0.5,
            1,
            Math.PI / 2,
            new THREE.Vector3(2, 8, 10),
            new THREE.Vector3(2, 0, -15),
            undefined,
            undefined,
            (instance) => {
              instance.castShadow = true;
              instance.shadow.radius = 5;
              instance.shadow.camera.left = -10;
              instance.shadow.camera.right = 10;
              instance.shadow.camera.top = 10;
              instance.shadow.camera.bottom = -10;
            }
          ),
        ],
      };
      scene.add(LIGHTS.ambient);

      /*
       * CAMERA
       */
      const perspectiveCamera = new THREE.PerspectiveCamera(
        75,
        SIZES.window.width / SIZES.window.height,
        0.1,
        10000
      );
      scene.add(perspectiveCamera);

      const orbitControls = new THREE.OrbitControls(perspectiveCamera);
      const camera = perspectiveCamera;

      // const camera = new FirstPersonCamera(perspectiveCamera);

      /*
       * RENDERER
       */
      const renderer = new THREE.WebGLRenderer({
        canvas,
        alpha: true,
        antialias: true,
      });
      renderer.setClearColor(new THREE.Color(0xeeeeee));
      renderer.shadowMap.enabled = true;

      /*
       * EVENTS
       */
      // Event handlers
      const handleResize = () => {
        // Update window sizes
        const width = (SIZES.window.width = window.innerWidth);
        const height = (SIZES.window.height = window.innerHeight);

        // Update camera
        perspectiveCamera.aspect = width / height;
        perspectiveCamera.updateProjectionMatrix();

        // Update renderer
        renderer.setSize(width, height);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      };

      // Event listeners
      window.addEventListener("resize", handleResize);

      /*
       * ANIMATIONS
       */
      // Helpers
      const calcProgressVector = (from, to, progress) =>
        new THREE.Vector3(
          from.x + (to.x - from.x) * progress,
          from.y + (to.y - from.y) * progress,
          from.z + (to.z - from.z) * progress
        );

      const updatePosition = (object, from, to, progress) => {
        const { x, y, z } = calcProgressVector(from, to, progress);
        object.position.set(x, y, z);
      };

      // Animation functions
      const openDoorAnimation = (
        door,
        hingesLocation = "left",
        openRotation = 1
      ) => {
        const initialRotation = door.rotation.y;
        const initialPosition = door.position.clone();

        const { width, depth } = door.geometry.parameters;
        const hingeRot = hingesLocation === "left" ? 1 : -1;
        const openRot = openRotation === 1 ? 1 : -1;

        const targetRotation =
          initialRotation + (openRot * hingeRot * Math.PI) / 2;
        const targetPosition = new THREE.Vector3(
          initialPosition.x - hingeRot * (width / 2 - depth / 2),
          initialPosition.y,
          initialPosition.z - (openRot * width) / 2
        );

        return (progress) => {
          door.rotation.y =
            initialRotation + (targetRotation - initialRotation) * progress;
          updatePosition(door, initialPosition, targetPosition, progress);
        };
      };

      const moveCamera =
        (camera, from, to, fromTarget, toTarget) => (progress) => {
          camera.position.copy(calcProgressVector(from, to, progress));
          camera.lookAt(calcProgressVector(fromTarget, toTarget, progress));
        };

      const rotateY = (object, from, to) => (progress) => {
        object.rotation.y = from + (to - from) * progress;
      };

      const update = () => {
        // Update stats
        stats.update();
        // Update camera
        // camera.update();
        // Update cube cameras
        ReflectiveSphere.update(renderer, scene);
        // Render the next frame
        renderer.render(scene, perspectiveCamera);
        // Request the new animation frame
        requestAnimationFrame(update);
      };

      /*
       * MAIN
       */
      const reflectiveSphere = new ReflectiveSphere(
        25,
        undefined,
        25,
        10000,
        500
      );
      const reflectiveSphereGroup = new THREE.Group();
      reflectiveSphereGroup.add(reflectiveSphere);
      reflectiveSphere.position.set(50, 10, 0);
      reflectiveSphere.track();
      scene.add(reflectiveSphereGroup);

      const church = new Construction(CHURCH, 1, {
        storeObjects: new Set(["d0"]),
      });
      scene.add(church);

      const [leftDoor, rightDoor] = church.getObjects("d0");

      handleResize();
      update();

      camera.position.set(-100, 15, 0);
      camera.lookAt(0, 30, 0);

      const openLeftDoor = openDoorAnimation(leftDoor, "left");
      const openRightDoor = openDoorAnimation(rightDoor, "right");

      const openDoor = (progress) => {
        openLeftDoor(progress);
        openRightDoor(progress);
      };

      const updateSpotLight = (
        spotLight,
        position,
        targetPosition,
        angle,
        distance
      ) => {
        const initial = {
          position: spotLight.position.clone(),
          targetPosition: spotLight.target.position.clone(),
          distance: spotLight.distance,
          angle: spotLight.angle,
        };

        return (progress) => {
          updatePosition(spotLight, initial.position, position, progress);
          if (targetPosition)
            updatePosition(
              spotLight.target,
              initial.targetPosition,
              targetPosition,
              progress
            );
          if (distance)
            spotLight.distance =
              initial.distance + (distance - initial.distance) * progress;
          if (angle)
            spotLight.angle =
              initial.angle + (angle - initial.angle) * progress;
        };
      };

      const mainAnimation = new Animation()
        .to(
          reflectiveSphereGroup.rotation,
          { y: 7 * Math.PI },
          {
            duration: 12,
            easing: Easing.easeInOut(),
            onUpdate(progress) {
              reflectiveSphere.cubeCamera.rotation.y =
                -Math.PI * Math.abs(Math.sin(3.5 * progress * Math.PI));
            },
            onFinish() {
              scene.add(LIGHTS.spot[0]);
              scene.add(LIGHTS.spot[1]);
              scene.add(LIGHTS.directional[0]);
              reflectiveSphere.remove();
            },
          }
        )
        .add("step1")
        .to(
          camera.position,
          {
            x: -30,
            y: 20,
            z: -10,
          },
          {
            delay: -1,
            duration: 3,
            easing: Easing.cubicBezier(0.5, 0.08, 0.25, 0.9),
            onUpdate(progress) {
              camera.lookAt(0, (1 - progress) * 20 + 10, 0);
            },
          },
          "step1"
        )
        .run(
          updateSpotLight(
            LIGHTS.spot[0],
            new THREE.Vector3(-35, 60, 15),
            new THREE.Vector3(-8, 14, -1)
          ),
          {
            duration: 2,
            delay: 1,
            easing: Easing.cubicBezier(0.5, 0.08, 0.25, 0.9),
          },
          "step1"
        )
        .add("step2")
        .to(
          church.rotation,
          { y: -0.5 * Math.PI },
          {
            easing: Easing.easeInOut(),
            duration: 2,
            delay: -1,
          },
          "step2"
        )
        .to(
          camera.position,
          { x: -15, y: 9, z: 4 },
          {
            easing: Easing.easeIn(),
            duration: 1.5,
            onUpdate(progress) {
              camera.lookAt(0, 10, 0);
            },
          },
          "step2"
        )
        .add("step3")
        .to(
          camera.position,
          { x: -6, y: 7.5, z: 5 },
          {
            duration: 1,
            onUpdate(progress) {
              camera.lookAt(0, 10 - 4 * progress, 5 * progress);
            },
          },
          "step3"
        )
        .run(
          openDoor,
          {
            duration: 1,
            delay: 0.5,
          },
          "step3"
        )
        .to(
          camera.position,
          { x: 2 },
          {
            delay: -0.5,
            duration: 2.5,
            easing: Easing.easeOut(),
            onUpdate(progress) {
              camera.lookAt(2 * progress, 6 + 10 * progress, 5 - 20 * progress);
            },
          }
        )
        .to(
          LIGHTS.spot[1],
          { distance: 200 },
          { duration: 2, delay: 1 },
          "step3"
        )
        .add("step4")
        .to(
          camera.position,
          { y: 12, z: 2 },
          {
            duration: 3,
            easing: Easing.easeInOut(),
            onUpdate(progress) {
              camera.lookAt(2, 16 - 20 * progress, -15 - 10 * progress);
            },
          },
          "step4"
        )
        .to(
          LIGHTS.directional[0].position,
          { x: 0, y: 20, z: 20 },
          {
            duration: 3,
          },
          "step4"
        )
        .add("step5")
        .to(
          camera.position,
          {
            x: 0,
            y: 25,
            z: -25,
          },
          {
            duration: 3,
            easing: Easing.easeInOut(),
            onUpdate(progress) {
              camera.lookAt(2, -4 + 20 * progress, -25 + 20 * progress);
            },
          },
          "step5"
        )
        .to(LIGHTS.spot[1], { distance: 1 }, { duration: 2, delay: 1 }, "step5")
        .run(
          updateSpotLight(
            LIGHTS.spot[0],
            new THREE.Vector3(0, 90, -60),
            new THREE.Vector3(-10, 10, 0)
          ),
          {
            duration: 2,
            delay: 2,
            easing: Easing.easeInOut(),
          },
          "step5"
        )
        .to(
          church.rotation,
          { y: -0.75 * Math.PI },
          {
            duration: 1.5,
            delay: -2,
            easing: Easing.easeInOut(),
          }
        );

      THREE.DefaultLoadingManager.onLoad = () => {
        mainAnimation.play();
      };
    </script>
  </body>
</html>
